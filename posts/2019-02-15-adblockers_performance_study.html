<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Adblockers performance study</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/adblockers_performance_study.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">.sharing-facebook{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%233b5998%22%2F%3E%3Cpath%20d%3D%22M17.936%2028.5V17.096h3.827l.574-4.444h-4.402V9.815c0-1.287.358-2.164%202.203-2.164h2.353V3.675c-.407-.055-1.804-.176-3.43-.176-3.392%200-5.715%202.072-5.715%205.875v3.278H9.51v4.443h3.838V28.5z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-pocket,.sharing-twitter{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%2300abf1%22%2F%3E%3Cpath%20d%3D%22M28.5%208.246a10.249%2010.249%200%2001-2.945.808%205.148%205.148%200%20002.255-2.837%2010.272%2010.272%200%2001-3.258%201.244%205.12%205.12%200%2000-3.743-1.62%205.13%205.13%200%2000-4.997%206.299A14.562%2014.562%200%20015.241%206.78a5.104%205.104%200%2000-.695%202.579%205.125%205.125%200%20002.282%204.269%205.115%205.115%200%2001-2.323-.641v.064a5.133%205.133%200%20004.114%205.03%205.163%205.163%200%2001-1.351.18c-.33%200-.653-.034-.966-.093a5.134%205.134%200%20004.791%203.562%2010.288%2010.288%200%2001-6.37%202.195c-.413%200-.821-.024-1.223-.072a14.516%2014.516%200%20007.863%202.305c9.434%200%2014.593-7.816%2014.593-14.593%200-.223-.006-.444-.015-.664a10.427%2010.427%200%20002.56-2.655z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-pocket{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23e84352%22%2F%3E%3Cpath%20d%3D%22M24.297%205.554H7.703c-1.631%200-2.953%201.332-2.953%202.976v8.243c0%20.153.012.303.034.45a6.366%206.366%200%2000-.034.666c0%204.725%205.037%208.557%2011.25%208.557s11.25-3.832%2011.25-8.557a6.71%206.71%200%2000-.034-.666c.022-.147.034-.297.034-.45V8.53c0-1.644-1.324-2.976-2.953-2.976zM22.9%2013.841l-5.811%205.81a1.49%201.49%200%2001-1.07.438%201.489%201.489%200%2001-1.107-.438l-5.81-5.81a1.494%201.494%200%20012.112-2.112L16%2016.516l4.787-4.787a1.494%201.494%200%20012.112%200%201.493%201.493%200%20010%202.112z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E)}.sharing-hackernews,.sharing-reddit{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23f68423%22%2F%3E%3Cpath%20d%3D%22M6.796%204.124l7.656%2015.157v8.595h3.114V19.28l7.638-15.157h-3.382l-5.82%2011.412-5.598-11.412z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-reddit{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23ef4623%22%2F%3E%3Cpath%20d%3D%22M21.374%2016.93a1.385%201.385%200%2001.094.504c0%20.34-.118.672-.315.942a1.495%201.495%200%2001-.798.565l-.006.002-.004.002a1.428%201.428%200%2001-.464.076%201.648%201.648%200%2001-1.006-.354%201.513%201.513%200%2001-.566-.92v-.005l-.001-.003a1.382%201.382%200%2001-.031-.293c0-.328.112-.643.296-.903a1.553%201.553%200%2001.746-.57h.003l.002-.002a1.535%201.535%200%2001.533-.096%201.664%201.664%200%2001.919.28c.268.178.485.44.595.764l.002.006.002.005h-.001zm-1%204.027a.797.797%200%2000-.432-.134.679.679%200%2000-.375.114%207.275%207.275%200%2001-3.693%201.02c-.968%200-1.93-.203-2.8-.632l-.005-.002-.005-.001c-.13-.054-.28-.168-.444-.278a1.653%201.653%200%2000-.266-.146.795.795%200%2000-.312-.07.697.697%200%2000-.288.066l-.015.006a.702.702%200%2000-.347.29.834.834%200%2000-.02.825.71.71%200%2000.286.287c1.246.84%202.712%201.221%204.185%201.22a9.127%209.127%200%20003.852-.867l.006-.003.006-.003c.157-.093.365-.176.562-.298a1.27%201.27%200%2000.273-.226.856.856%200%2000.184-.342.697.697%200%2000-.05-.486.845.845%200%2000-.301-.34zm-8.744-2.02a.022.022%200%2001.007.002%201.412%201.412%200%2000.486.087c.404%200%20.798-.166%201.095-.436a1.48%201.48%200%2000.502-1.091c0-.012%200-.023-.002-.037a1.168%201.168%200%2000.002-.063c0-.433-.2-.818-.495-1.09a1.63%201.63%200%2000-1.094-.44c-.109%200-.22.014-.328.039h-.006a1.592%201.592%200%2000-1.184%201.062v.002a1.458%201.458%200%2000-.073.459c0%20.336.111.664.303.934a1.5%201.5%200%2000.787.573zm16.865-3.924v.002a3.084%203.084%200%2001-.515%201.85%203.389%203.389%200%2001-1.203%201.115c.03.241.049.485.049.728a6.026%206.026%200%2001-1.237%203.623h-.002c-1.451%201.93-3.68%203.069-5.93%203.643l-.003.002a15.582%2015.582%200%2001-3.674.44%2014.52%2014.52%200%2001-5.406-1.022v-.002h-.002c-1.783-.734-3.482-1.902-4.523-3.613a5.892%205.892%200%2001-.869-3.061c0-.243.017-.487.05-.729a3.49%203.49%200%2001-1.178-1.086%203.201%203.201%200%2001-.552-1.639v-.009c0-.833.362-1.623.925-2.204.563-.582%201.33-.962%202.154-.962h.035a3.714%203.714%200%2001.261-.01%203.408%203.408%200%20011.223.219l.002.001h.002a4.1%204.1%200%2001.968.55c.096-.051.202-.108.32-.153%201.806-1.07%203.904-1.482%205.95-1.6.018-1.014.142-2.074.636-3.003.412-.77%201.126-1.371%201.977-1.579l.003-.002h.004a5.132%205.132%200%2001.975-.092c.864%200%201.718.205%202.517.524.354-.533.859-.95%201.452-1.184l.005-.003.006-.002a3.665%203.665%200%20011.083-.172c.39%200%20.781.07%201.149.235l.008.002c.527.203.972.578%201.288%201.043.316.469.502%201.029.502%201.605a2.756%202.756%200%2001-.018.32l-.001.001v.006c-.063.744-.44%201.397-.973%201.863a2.995%202.995%200%2001-1.947.75%202.85%202.85%200%2001-.345-.02c-.708-.055-1.369-.398-1.854-.908-.486-.508-.8-1.189-.8-1.922%200-.035.004-.072.005-.107-.665-.296-1.37-.542-2.072-.541a2.8%202.8%200%2000-.304.016h-.002a1.586%201.586%200%2000-1.25.857v.002c-.358.7-.43%201.517-.442%202.33%202.014.13%204.04.614%205.815%201.635h.003l.026.014c.033.02.096.055.152.085.122-.1.25-.201.399-.289a3.279%203.279%200%20011.814-.537c.283%200%20.567.036.842.107h.001l.012.003.01.002a3.36%203.36%200%20011.68%201.043c.443.504.74%201.14.799%201.834zm-5.93-6.589c0%20.027%200%20.055.003.084v.005c.013.35.178.675.43.915.251.24.586.39.926.391h.008c.025.002.05.002.073.002.343%200%20.683-.147.939-.387.256-.24.425-.568.438-.92v-.005a.793.793%200%2000.004-.08c0-.362-.17-.709-.436-.965a1.43%201.43%200%2000-.972-.414%201.1%201.1%200%2000-.336.05h-.007a1.485%201.485%200%2000-.756.492%201.315%201.315%200%2000-.315.832zM7.702%2013.821c-.27-.125-.547-.215-.822-.213a1.093%201.093%200%2000-.14.007h-.006l-.006.002a1.72%201.72%200%2000-1.094.458%201.522%201.522%200%2000-.512%201.056v.008a1.226%201.226%200%2000-.004.097c0%20.253.077.497.21.719.096.165.223.317.368.448.461-1.01%201.183-1.869%202.006-2.582zm17.54%204.944c0-.901-.326-1.806-.853-2.535-1.049-1.46-2.676-2.412-4.37-2.943l-.011-.004a13.78%2013.78%200%2000-.984-.263%2013.603%2013.603%200%2000-3.018-.338%2013.675%2013.675%200%2000-4.025.603c-1.693.537-3.326%201.483-4.373%202.948v.001a4.397%204.397%200%2000-.842%202.544c0%20.333.042.665.13.99h.001c.19.727.563%201.376%201.046%201.941a7.521%207.521%200%20001.696%201.444%2011.725%2011.725%200%2000.418.246c1.807%201.008%203.888%201.45%205.954%201.45.35%200%20.7-.012%201.048-.037%202.08-.171%204.17-.786%205.859-2.04v-.002a6.567%206.567%200%20001.43-1.425%204.62%204.62%200%2000.814-1.824v-.003a3.577%203.577%200%2000.079-.753zm1.641-3.585a1.345%201.345%200%2000-.16-.64l-.002-.002-.002-.004a1.562%201.562%200%2000-.653-.684%201.897%201.897%200%2000-.928-.236%201.9%201.9%200%2000-.846.197c.826.717%201.55%201.58%202.02%202.594a1.692%201.692%200%2000.375-.47c.125-.234.196-.496.196-.755z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E)}body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1{line-height:1.1em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}h1,h2,h3{padding-top:.7em}.header{color:#555;margin-top:-.8em}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;font-style:italic;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{display:block;overflow-x:auto}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.sharing{display:inline-block;height:32px;width:32px}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>Adblockers performance study</h1><section class="header"><div>└─ 2019-02-15 • <em>Reading time: ~16 minutes</em></div></section><article><div class="main"><p><strong>Disclaimer</strong>: This study was originally posted on <a href="https://whotracks.me/blog/adblockers_performance_study.html" target="_blank" rel="noopener noreferrer">WhoTracks.me</a>.</p><p>Summary: <em>In this study we show</em></p><ul><li><em>That all popular content-blockers are very efficient, having sub-millisecond median decision time per request</em></li><li><em>That the manifest v3 performance claim does not hold based on our measurements</em></li><li><em>That the adblocker used by Cliqz and Ghostery consistently performs as well or better than other popular content-blockers.</em></li></ul><hr><p>Here we present a detailed analysis of the performance of some of the most popular content-blocker engines: <em>uBlock Origin</em>, <em>Adblock Plus</em>, <em>Brave</em>, <em>DuckDuckGo</em> and <em>Cliqz/Ghostery’s</em> advanced adblocker (shipped since Ghostery 8), which we will refer to as <em>Ghostery</em> for the rest of the article.</p><p>This study was motivated by the recent <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=896897" target="_blank" rel="noopener noreferrer">Manifest V3 controversy</a>. One of the proposed changes involves crippling the WebRequest APIs to limit their blocking abilities. Two justifications were put forth: one related to <em>performance</em> and another related to privacy. The privacy argument deserves its own separate analysis and will not be covered here. In this study, we show that the <em>performance</em> argument does not hold. Our comparison demonstrates that the most popular content-blockers are already very efficient (having a sub-millisecond median decision time per request) and should not result in any over-head noticeable by users. We showed in another study <a href="https://www.ghostery.com/lp/trackertax/" target="_blank" rel="noopener noreferrer">The Tracker Tax</a> that blocking ads and trackers actually reduces the loading time of websites by <strong>up to a factor of 2</strong>. Besides, efficiency is continuously improved and technologies such as WebAssembly will allow to go even further.</p><p>This comparison does not involve full extensions, but instead <strong>focuses on network request blocking engines</strong>, which is the most CPU intensive task performed by content-blockers (in particular, this does not account for cosmetics engines or subscription management). Here are the home pages for all content-blockers compared:</p><ul><li>Ghostery and Cliqz’s adblocker: <a href="https://github.com/cliqz-oss/adblocker" target="_blank" rel="noopener noreferrer">https://github.com/cliqz-oss/adblocker</a></li><li>Brave’s adblocker: <a href="https://github.com/brave/ad-block" target="_blank" rel="noopener noreferrer">https://github.com/brave/ad-block</a></li><li>DuckDuckGo’s adblocker: <a href="https://github.com/duckduckgo/abp-filter-parser" target="_blank" rel="noopener noreferrer">https://github.com/duckduckgo/abp-filter-parser</a></li><li>uBlock Origin: <a href="https://github.com/gorhill/uBlock" target="_blank" rel="noopener noreferrer">https://github.com/gorhill/uBlock</a></li><li>Adblock Plus: <a href="https://github.com/adblockplus/adblockpluscore" target="_blank" rel="noopener noreferrer">https://github.com/adblockplus/adblockpluscore</a></li></ul><p>We did not include native blockers from Chromium and Safari projects as this would require some significant effort to package them in a way that allows benchmarking against the other libraries. We leave this for future work.</p><p>All blockers except <em>uBlock Origin</em> are available as JavaScript libraries which can be loaded in Node.js. To allow comparing <em>uBlock Origin</em> as well, we had to extract the static network filtering engine <a href="https://github.com/cliqz-oss/adblocker/blob/master/bench/comparison/ublock.js" target="_blank" rel="noopener noreferrer">out of the extension</a>. The version of <em>uBlock Origin</em> running in this benchmark <em>does not make use of the Webassembly</em> version of domain matching.</p><p>All benchmarks were ran on an X1 Carbon 2016 (i7 U6600 + 16 GB) in Node.js 11.9.0. Memory measurements were performed in Google Chrome version 72.0.3626.96 using the memory snapshot tool.</p><h2>Results</h2><p>Before presenting the detailed analysis of the results, let us highlight our findings in a nutshell:</p><ul><li><p>All content-blockers except <em>DuckDuckGo</em> have <strong>sub-millisecond median decision time</strong> per request.</p></li><li><p><strong>Time to Process a Request in Ghostery</strong> (median): <strong>0.007 ms</strong></p><ul><li>2.7x faster than <em>uBlock Origin</em></li><li>2.9x faster than <em>Adblock Plus</em></li><li>6.3x faster than <em>Brave</em>’s Adblocker</li><li>1258.4x faster than <em>DuckDuckGo</em>’s adblocker</li></ul></li><li><p><strong>Loading Ghostery’s Blocking Engine</strong> (from cache): <strong>0.03 ms</strong></p><ul><li>368x faster than <em>Brave</em>’s Adblocker</li><li>588x faster than <em>uBlock Origin</em></li><li>3575x faster than <em>Adblock Plus</em></li><li><em>DuckDuckGo</em>’s adblocker does not offer serialization, so the loading cost is always the one from parsing the lists.</li></ul></li><li><p><strong>Memory Consumption of Ghostery’s Blocking Engine</strong> (at startup, in Chrome): <strong>1.8 MB</strong></p><ul><li>1.6x less memory than <em>uBlock Origin</em></li><li>8.4x less memory than <em>Adblock Plus</em></li><li>8.8x less memory than <em>DuckDuckGo</em>’s adblocker</li><li>The memory usage of <em>Brave</em> could not be evaluated using the devtools and thus is not included in this section.</li></ul></li></ul><h3>About the Dataset</h3><p>To measure the performance of each content-blocker, we replayed requests from popular domains <em>once</em> and kept track of the time it took to decide if they should be blocked or not. We then analyzed the results in three different ways: all requests, blocked only and not blocked (taken from the same run).</p><p>This requests dataset was created using a pool of Chrome headless browsers (driven by the <a href="https://github.com/GoogleChrome/puppeteer" target="_blank" rel="noopener noreferrer"><code>puppeteer</code> library</a>) to visit home pages of the <em>top 500 domains</em> (as reported by Cliqz Search), as well as up to 3 pages of each domain (picked randomly from the home page) and collecting all the network requests seen (URL, frame URL and type). The dataset was shuffled in such a way that the different pages were visited in a random order, but requests seen on each page were replayed as they were recorded initially.</p><p>The dataset is composed of 242944 requests. We released the data publicly at this URL: <a href="https://cdn.cliqz.com/adblocking/requests_top500.json.gz" target="_blank" rel="noopener noreferrer">requests_top500.json.gz</a>. The script to create the dataset is also available: <a href="https://github.com/cliqz-oss/adblocker/blob/master/bench/comparison/create_dataset.js" target="_blank" rel="noopener noreferrer">create_dataset.js</a> and <a href="https://github.com/cliqz-oss/adblocker/blob/master/bench/comparison/shuffle_dataset.js" target="_blank" rel="noopener noreferrer">shuffle_dataset.js</a> was used to shuffle the requests to produce the final data.</p><h3>Composition of Requests</h3><p>For the purpose of this comparison, we consider that each network request can be either blocked or allowed by the content-blocker; we call the process of deciding whether a request should be blocked or not: <em>matching</em>. We observed that from our dataset, only ~19.2% are blocked (average across all content-blockers).</p><figure><a href="../images/adblockers_performance_study/requests-composition.svg"><img src="../images/adblockers_performance_study/requests-composition.svg" alt="Proportion of requests blocked"></a></figure><p>It results from this observation that content-blockers will perform better on average if they can efficiently decide which requests to <em>not block</em>.</p><p>The filters used to determine whether or not a request is to be blocked are the ones from <a href="https://easylist-downloads.adblockplus.org/easylist.txt" target="_blank" rel="noopener noreferrer">Easylist</a>, where we removed all the cosmetic rules before running the benchmarks. The final list contains <em>38978 network filters</em> and is available here: <a href="https://github.com/cliqz-oss/adblocker/blob/master/bench/comparison/easylist.txt" target="_blank" rel="noopener noreferrer">easylist.txt</a>.</p><p>It should be noted at this point that a larger proportion of requests would be blocked by enabling extra filters lists such as <em>EasyPrivacy</em>.</p><h3>Time To Match All Requests</h3><p>We first look at all of the requests (whether they will eventually be blocked or not). We use a log-scale for the x-axis (time in milliseconds) to facilitate the comparison of the cumulative distribution of the time it takes for content-blockers to decide whether or not a request should be blocked.</p><p>Here is a break-down of the 99th percentile and median times for each content-blocker:</p><table><thead><tr><th></th><th>99% OF REQUESTS</th><th>MEDIAN</th></tr></thead><tbody><tr><td><strong>Ghostery</strong></td><td><strong>0.050ms</strong></td><td><strong>0.007ms</strong></td></tr><tr><td>uBlock Origin</td><td>0.124ms (<strong>2.5x slower</strong>)</td><td>0.017ms (<strong>2.7x slower</strong>)</td></tr><tr><td>Adblock Plus</td><td>0.103ms (<strong>2.1x slower</strong>)</td><td>0.019ms (<strong>2.9x slower</strong>)</td></tr><tr><td>Brave</td><td>1.288ms (<strong>25.9x slower</strong>)</td><td>0.041ms (<strong>6.3x slower</strong>)</td></tr><tr><td>DuckDuckGo</td><td>12.085ms (<strong>242.5x slower</strong>)</td><td>8.270ms (<strong>1258.4x slower</strong>)</td></tr></tbody></table><p>Below you can find the cumulative distribution plots of these timings:</p><figure><a href="../images/adblockers_performance_study/ghostery-ublock-origin-brave-duckduckgo-adblock-plus-all.svg"><img src="../images/adblockers_performance_study/ghostery-ublock-origin-brave-duckduckgo-adblock-plus-all.svg" alt="Time to match all requests"></a></figure><h3>Time To Match Requests Which Are Not Blocked</h3><p>The following table details 99th percentile and median timings for requests not blocked:</p><table><thead><tr><th></th><th>99% OF REQUESTS</th><th>MEDIAN</th></tr></thead><tbody><tr><td><strong>Ghostery</strong></td><td><strong>0.049ms</strong></td><td><strong>0.006ms</strong></td></tr><tr><td>uBlock Origin</td><td>0.112ms (<strong>2.3x slower</strong>)</td><td>0.018ms (<strong>2.8x slower</strong>)</td></tr><tr><td>Adblock Plus</td><td>0.105ms (<strong>2.2x slower</strong>)</td><td>0.020ms (<strong>3.1x slower</strong>)</td></tr><tr><td>Brave</td><td>1.270ms (<strong>26.2x slower</strong>)</td><td>0.038ms (<strong>5.9x slower</strong>)</td></tr><tr><td>DuckDuckGo</td><td>11.190ms (<strong>230.5x slower</strong>)</td><td>6.781ms (<strong>1060.5x slower</strong>)</td></tr></tbody></table><figure><a href="../images/adblockers_performance_study/ghostery-ublock-origin-brave-duckduckgo-adblock-plus-not-blocked.svg"><img src="../images/adblockers_performance_study/ghostery-ublock-origin-brave-duckduckgo-adblock-plus-not-blocked.svg" alt="Time to match requests which are not blocked"></a></figure><h3>Time To Match Requests Which Are Blocked</h3><p>The following table details 99th percentile and median timings for requests blocked:</p><table><thead><tr><th></th><th>99% OF REQUESTS</th><th>MEDIAN</th></tr></thead><tbody><tr><td><strong>Ghostery</strong></td><td><strong>0.052ms</strong></td><td><strong>0.007ms</strong></td></tr><tr><td>uBlock Origin</td><td>0.165ms (<strong>3.1x slower</strong>)</td><td>0.016ms (<strong>2.2x slower</strong>)</td></tr><tr><td>Adblock Plus</td><td>0.099ms (<strong>1.9x slower</strong>)</td><td>0.014ms (<strong>1.9x slower</strong>)</td></tr><tr><td>Brave</td><td>1.468ms (<strong>28.0x slower</strong>)</td><td>0.062ms (<strong>8.5x slower</strong>)</td></tr><tr><td>DuckDuckGo</td><td>13.025ms (<strong>248.5x slower</strong>)</td><td>8.31ms (<strong>1130.6x slower</strong>)</td></tr></tbody></table><figure><a href="../images/adblockers_performance_study/ghostery-ublock-origin-brave-duckduckgo-adblock-plus-blocked.svg"><img src="../images/adblockers_performance_study/ghostery-ublock-origin-brave-duckduckgo-adblock-plus-blocked.svg" alt="Time to match requests which are blocked"></a></figure><p>On these graphs we observe a plateau for <em>Adblock Plus</em>, <em>Brave</em> and <em>Duckduckgo</em>. This can be explained by the fact that these engines implement some form of caching internally, thus having a very fast response time for some requests which were already seen (redundancy in requests comes from both common third-parties seen on multiple websites as well as the fact that we load several pages for each domain). This caching can be implemented on top of any content-blocker and does not tell much about the efficiency of each; we can see this as a means to trade <em>memory</em> against <em>CPU usage</em>.</p><p>From the previous measurements we see that Ghostery out-performs other libraries in terms of matching speed. Without going into too many details, here are some of the optimizations which can explain these results:</p><ul><li>Ghostery makes use of a reverse index associating tokens to filters. Contrary to other libraries, we make sure that we pick <em>the best</em> token for each filter at construction time (best being defined as the <em>least seen token</em>). This incurs a one-time extra cost but results in maximized dispatching capabilities.</li><li>Filters are stored in a very compact form, in typed arrays, and only loaded in memory lazily, when there is a chance they will be blocked (if we encounter identical tokens in URLs).</li><li>Filters loaded in memory are optimized on-the-fly and multiple filters can be combined for increased efficiency. The optimizations were carefully crafted based on common cases observed in Easylist.</li></ul><h3>Serialization And Deserialization</h3><p>In this section we have a look at the performance of content-blockers when it comes to serializing their internal representation for faster subsequent loading. Only <em>DuckDuckGo</em>’s engine does not provide this feature. <em>uBlock Origin</em>, <em>Ghostery</em>, <em>Adblock Plus</em> and <em>Brave</em> all allow to serialize or cache (<em>uBlock Origin</em>’s terminology is: <em>selfies</em>) the entire blocking engine to either a string or a buffer, which can then be used to speed-up subsequent loads.</p><p>Because this is a one-time operation, having a higher loading-time does not impact significantly desktop users. On the other hand, the ability to quickly initialize the content-blocker is critical on mobile.</p><p>Another use-case allowed by such capability is to perform the parsing of the lists on the backend and ship the serialized form of the content-blocker to clients directly, which removes the cost of initialization completely.</p><p>We performed 100 serializations for each content-blocker and display the results below:</p><figure><a href="../images/adblockers_performance_study/ghostery-ublock-origin-brave-adblock-plus-serializationtimings.svg"><img src="../images/adblockers_performance_study/ghostery-ublock-origin-brave-adblock-plus-serializationtimings.svg" alt="Serialization timings"></a></figure><p>This bar plot contains the median time taken to serialize the engine for each content-blocker:</p><figure><a href="../images/adblockers_performance_study/serializationtimings.svg"><img src="../images/adblockers_performance_study/serializationtimings.svg" alt="Serialization timings"></a></figure><p>Similarly, we measure the time it takes to restore the content-blocker from its serialized form:</p><figure><a href="../images/adblockers_performance_study/ghostery-ublock-origin-brave-adblock-plus-deserializationtimings.svg"><img src="../images/adblockers_performance_study/ghostery-ublock-origin-brave-adblock-plus-deserializationtimings.svg" alt="Deserialization timings"></a></figure><p>And here is the median time:</p><figure><a href="../images/adblockers_performance_study/deserializationtimings.svg"><img src="../images/adblockers_performance_study/deserializationtimings.svg" alt="Deserialization timings"></a></figure><p>Last but not least, we measured the size of the serialized buffer for each content-blocker:</p><figure><a href="../images/adblockers_performance_study/cache-size.svg"><img src="../images/adblockers_performance_study/cache-size.svg" alt="Cache size"></a></figure><p>From these measurements we see that <em>Ghostery</em> offers both significantly faster serialization and deserialization times as well as a smaller cache size.</p><p>The reason is the following: the internal representation is already mostly stored in a compact form (using typed arrays); this means that serialization only consists in adding a small amount of metadata along-side the already available arrays and deserialization is <em>essentially instantaneous</em> since it’s enough to create some typed array views on top of the serialized buffer (think of <code>mmap</code> but using typed arrays). This also explains the very low memory consumption: after initialization, the memory usage is only slightly higher than the size of the serialized form.</p><h3>Memory Consumption at Start-up</h3><p>Here we consider the memory usage of each content-blocker, initialized from lists (not from cache) after one full garbage collection. The measurements were performed using Chrome’s devtools memory snapshot. We did not measure Brave here since the memory used from C++ side does not seem to be taken into account in the snapshot. Also keep in mind that this memory usage can vary at run-time as content-blockers might cache frequently used resources, etc.</p><figure><a href="../images/adblockers_performance_study/memory-usage-at-startup.svg"><img src="../images/adblockers_performance_study/memory-usage-at-startup.svg" alt="Memory usage at start-up"></a></figure><p>As mentioned in the previous section on serialization, the very low memory usage of <em>Ghostery</em> can be explained by the fact that the internal representation mostly consists of very compact typed arrays with some small over-head for extra meta-data. Again, we need to stress here that this measures the network filtering engine of Ghostery only, not the full extension, as described in the introduction.</p><h3>Parsing Lists</h3><p>In this graph, we present the time it takes for each content-blocker to be initialized from the lists (without any prior caching, which means initializing all internal resources by parsing the raw list). We see that only Brave seems to be significantly slower and that <em>uBlock Origin</em>, <em>Ghostery</em>, <em>Adblock Plus</em> and <em>DuckDuckGo</em> all perform well.</p><figure><a href="../images/adblockers_performance_study/time-to-parse-easylist-all.svg"><img src="../images/adblockers_performance_study/time-to-parse-easylist-all.svg" alt="Time to parse Easylist"></a></figure><p>It seems that the long parsing time for Brave is a <a href="https://github.com/brave/ad-block/issues/158" target="_blank" rel="noopener noreferrer">known issue</a> tracked on their GitHub repository.</p><p>Now if we remove Brave, we see that there are still differences between <em>uBlock Origin</em>, <em>Ghostery</em>, <em>Adblock Plus</em> and <em>DuckDuckGo</em>. One reason <em>Ghostery</em> is slower than <em>uBlock Origin</em> and <em>AdblockPlus</em> here is that to achieve maximum performance while matching as well as minimize memory usage, there is a bit more work to do up-front. In practice this does not matter so much since it is a one-time operation and that subsequent loads are performed from cache, and this is really fast (in fact, we can even perform the parsing backend-side and just ship the serialized version of the blocker, which removes this step completely).</p><figure><a href="../images/adblockers_performance_study/time-to-parse-easylist-without-brave.svg"><img src="../images/adblockers_performance_study/time-to-parse-easylist-without-brave.svg" alt="Time to parse Easylist without Brave"></a></figure><h3>Conclusion</h3><p>In this study we looked closely at the performance of some of the most popular content-blockers in use today. In particular, we focused on the efficiency of their network filtering engines, which is the most CPU intensive task they perform.</p><p>This work was motivated by one of the claims formulated in the <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=896897" target="_blank" rel="noopener noreferrer">Manifest V3 proposal</a> of the Chromium project: <em>“the extension then performs arbitrary (and potentially very slow) JavaScript”</em>, talking about content-blockers’ ability to process all network requests. From the measurements, we do not think this claim holds, as all popular content-blockers are already very efficient and should not incur any noticeable slow-down for users. Moreover, the efficiency of content-blockers is <em>continuously improving</em>, either thanks to more innovative approaches or using technologies like WebAssembly to reach native performance.</p><p>While most content-blockers are indeed efficient, they are not equivalent and we observed that <em>Ghostery</em> performs consistently as well or better across all dimensions, often surpassing other libraries.</p><p>We hope that these benchmarks will give an opportunity for content-blockers developers to measure their own progress against other popular libraries; benefiting all users, no matter which extension they use, as the efficiency of content-blockers improves.</p></div><div class="comments"></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io/posts/adblockers_performance_study.html&t=Adblockers performance study" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-facebook"></div></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io/posts/adblockers_performance_study.html&text=Adblockers performance study&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-twitter"></div></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io/posts/adblockers_performance_study.html&title=Adblockers performance study" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-pocket"></div></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io/posts/adblockers_performance_study.html&t=Adblockers performance study" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-hackernews"></div></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io/posts/adblockers_performance_study.html&title=Adblockers performance study" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-reddit"></div></a></li></ul></div></footer></main></body></html>