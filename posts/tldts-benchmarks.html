<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Fast domains and URLs parsing with tldts</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/tldts-benchmarks.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1,h2,h3{padding-top:.7em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}.header,.main figcaption{color:#555;font-style:italic}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{display:block;overflow-x:auto}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.share img{width:2em}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>Fast domains and URLs parsing with tldts</h1><section class="header"><div>2019-02-02 | <em>Reading time: ~10 minutes</em></div></section><article><div class="main"><p>For quite some time now I’ve been working on <a href="https://github.com/remusao/tldts/"><strong>tldts</strong></a> (<a href="https://www.npmjs.com/package/tldts"><strong>npm</strong></a>), an <em>extemely fast</em>, <em>feature-full</em>, <em>battle-tested</em> JavaScript library for domain parsing. It allows to answer questions such has:</p><ul><li>What’s the hostname of an URL?</li><li>What’s the registrable domain of an URL, a hostname or an email address?</li><li>What’s the sub-domain of a domain?</li><li>etc.</li></ul><p>What puts <a href="https://github.com/remusao/tldts/"><strong>tldts</strong></a> appart from other libraries is:</p><ul><li>It is <strong>much faster</strong> than alternatives, allowing to parse between <strong>1 and 2 million</strong> domains per second (that’s <strong>up to 1000 times</strong> faster than other popular libraries).</li><li>It is more feature-full, supporting <em>IPs detection</em>, <em>domain validation</em> and <em>complex URLs parsing</em>.</li><li>It offers the smallest bundles, in both <code>cjs</code>, <code>esm</code> and <code>umd</code> formats; it runs <em>anywhere</em>.</li><li>It is written in <em>TypeScript</em> and benefits from 100% test coverage.</li></ul><p>Most of the features are made possible by the <a href="https://publicsuffix.org/">public suffix list</a> project. But <a href="https://github.com/remusao/tldts/"><strong>tldts</strong></a> offers some bells and whistles on top. One of the goals is to be <em>conveniant</em> to use and as fast as it gets. Some libraries require you to provide already-valid hostnames, but <a href="https://github.com/remusao/tldts/"><strong>tldts</strong></a> has no such constraints and will happily parse complex URLs, as well as already-extracted hostnames. The best part is that this does not come with any over-head!</p><pre><code class="language-javascript"><span class="hljs-keyword">const</span> tldts = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tldts'</span>);

<span class="hljs-comment">// Retrieving hostname related informations of a given URL</span>
tldts.parse(<span class="hljs-string">'https://remusao.github.io/posts/tldts-benchmarks.html'</span>);
<span class="hljs-comment">// { domain: 'github.io',</span>
<span class="hljs-comment">//   hostname: 'remusao.github.io',</span>
<span class="hljs-comment">//   isIcann: true,</span>
<span class="hljs-comment">//   isIp: false,</span>
<span class="hljs-comment">//   isPrivate: false,</span>
<span class="hljs-comment">//   publicSuffix: 'io',</span>
<span class="hljs-comment">//   subdomain: 'remusao' }</span></code></pre><p>In this post I’d like to share some results of a performance comparison against other available JavaScript libraries offering the same kind of features. We will see that they vary greatly in terms of performance, ease of use or features. In fact, we observed that <code>tldts</code> is up to <strong>1000 times</strong> faster than some of the other libraries!</p><p>Before presenting the results, a few words about the instrumentation and what was measured. We aim at comparing the libraries in the following aspects:</p><ol><li>Features</li><li>Performance (in terms of operations per second)</li><li>Loading time (time it took V8 to load the bundle)</li><li>Memory used</li></ol><p>All the measurements were performed in the following environment:</p><ul><li><code>Node.js</code> version <strong>11.6.0</strong></li><li>Hardware: X1 Carbon 4th with i7-6600U CPU and 16GB of RAM</li></ul><p>And now the list of the contenders:</p><ul><li><a href="https://www.npmjs.com/package/tldts"><strong>tldts</strong></a></li><li><a href="https://www.npmjs.com/package/psl">psl</a></li><li><a href="https://www.npmjs.com/package/tldjs">tld.js</a></li><li><a href="https://www.npmjs.com/package/parse-domain">parse-domain</a></li><li><a href="https://www.npmjs.com/package/haraka-tld">haraka-tld</a></li><li><a href="https://github.com/gorhill/uBlock/blob/master/src/lib/publicsuffixlist.js">uBlock’s publicsuffixlist.js</a></li></ul><p>In the results you will also see <code>tldts-experimental</code> mentioned. It is a probabilistic data-structure implementing the exact same features as <code>tldts</code> but using <em>much less memory</em>, <em>loading instantly</em> and offering <em>even higher performances</em>. It can be used in contexts with very constrained hardware capabilities such as mobiles.</p><p>Now let’s now dig into the results!</p><h2 id="feature-matrix">Feature Matrix</h2><p>The following features are considered:</p><ul><li>Is there <code>IDNA</code> support? Does the library support inputs with unicode such as <em>中国</em>?</li><li>Does the library accept complex <code>URLs</code> as input, or is it necessary to extract the hostname before-hand?</li><li>Is the library able to detect if the given input is an <code>IP</code> address? This is important, otherwise <code>getPublicSuffix(&#39;192.168.0.1&#39;)</code> would return <code>1</code>!</li><li>Does the library allow you to extract <code>domain</code> and <code>public suffix</code>?</li><li>Does the library support ICANN/Private sections of the public suffix list? Can they be disabled individually?</li><li>Will the public suffix rules be <code>shipped</code> with the library, or do they need to be fetched separately?</li></ul><table><thead><tr><th align="center">Library</th><th align="center">IDNA</th><th align="center">URLs</th><th align="center">IPs</th><th align="center">getDomain</th><th align="center">getPublicSuffix</th><th align="center">ICANN/Private</th><th align="center">Ships lists</th></tr></thead><tbody><tr><td align="center"><strong>tldts</strong></td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td></tr><tr><td align="center">tld.js</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td></tr><tr><td align="center">psl</td><td align="center">X</td><td align="center"></td><td align="center"></td><td align="center">X</td><td align="center">X</td><td align="center"></td><td align="center">X</td></tr><tr><td align="center">parse-domain</td><td align="center">X</td><td align="center">X</td><td align="center"></td><td align="center">X</td><td align="center">X</td><td align="center">X</td><td align="center">X</td></tr><tr><td align="center">haraka-tld</td><td align="center">X</td><td align="center">X</td><td align="center"></td><td align="center">X</td><td align="center">X</td><td align="center"></td><td align="center">X</td></tr><tr><td align="center">uBlock publicsuffixlist</td><td align="center">?</td><td align="center"></td><td align="center"></td><td align="center">X</td><td align="center">X</td><td align="center"></td><td align="center"></td></tr></tbody></table><h1 id="performance">Performance</h1><p>Here we measure the performance of three common operations offered by domain parsing library: <em>getting the public suffix</em> of a hostname, <em>getting the domain</em> (tld + sld) and <em>getting the subdomain</em>.</p><p>A few notes about this benchmark:</p><ul><li>The inputs used are always already valid hostnames (no URLs, although some libraries like tldts support it). You can find the list of inputs there:</li><li>The selection of hostnames can be seen in <a href="https://github.com/remusao/tldts/blob/master/comparison/bench_performance.js#L12">bench_performance.js</a> and was selected to contain a mix of non-existing suffixes, ICANN rules, private rules as well as wildcards and exceptions.</li><li>All hostnames were ASCII (puny-encoded if needed before-hand)</li><li>All libraries were used in their default setup (no option given, with the exception of <code>tldts-no-parse</code> which runs <code>tldts</code> disabling the parsing phase and assuming that the input is already a valid hostname, to match the behavior of other libraries).</li></ul><p>The results are expressed in terms of operations per second (where each operation is calling the function once on a hostname).</p><table><thead><tr><th align="left">Library</th><th align="right">getPublicSuffix</th><th align="right">getDomain</th><th align="right">getSubdomain</th></tr></thead><tbody><tr><td align="left"><strong>tldts-experimental</strong></td><td align="right">1 898 446</td><td align="right">1 690 572</td><td align="right">1 615 166</td></tr><tr><td align="left">tldts no parsing</td><td align="right">1 780 469</td><td align="right">1 515 703</td><td align="right">1 502 692</td></tr><tr><td align="left"><strong>tldts</strong></td><td align="right"><strong>1 280 063</strong></td><td align="right"><strong>1 134 956</strong></td><td align="right">1 125 362</td></tr><tr><td align="left">tld.js</td><td align="right">1 141 414</td><td align="right">1 049 180</td><td align="right">1 125 362</td></tr><tr><td align="left">ublock publicsuffix</td><td align="right">620 816</td><td align="right">567 664</td><td align="right">?</td></tr><tr><td align="left">parse-domain</td><td align="right">554 355</td><td align="right">528 217</td><td align="right">551 008</td></tr><tr><td align="left">haraka-tld</td><td align="right">?</td><td align="right">105 321</td><td align="right">?</td></tr><tr><td align="left">psl</td><td align="right">1 654</td><td align="right">1 693</td><td align="right">1 673</td></tr></tbody></table><p>Here we see that the performance varies a lot between libraries, for the same operations. <code>tldts</code> is <strong>1000</strong> faster than <code>psl</code>, which is the most popular library.</p><h1 id="memory-usage">Memory Usage</h1><p>Here we estimate the memory used by each library. The measurements are done using the <a href="https://github.com/remusao/tldts/blob/master/comparison/bench_memory.js">bench_memory.js</a> script, which loads each file ten times and measure the average memory usage before and after GC using <code>process.memoryUsage()</code>. The result are then compared to a reference memory usage computed in the same way using <code>noop_test.js</code> which does not import anything.</p><table><thead><tr><th align="left">Library</th><th align="right">Before GC</th><th align="right">After GC</th></tr></thead><tbody><tr><td align="left"><strong>tldts-experimental</strong></td><td align="right"><strong>461KB</strong></td><td align="right"><strong>229 KB</strong></td></tr><tr><td align="left">parse-domain</td><td align="right">2.579 MB</td><td align="right">1.310MB</td></tr><tr><td align="left">psl</td><td align="right">2.199 MB</td><td align="right">1.537MB</td></tr><tr><td align="left">tldjs</td><td align="right">2.621 MB</td><td align="right">1.714MB</td></tr><tr><td align="left">tldts</td><td align="right">3.094 MB</td><td align="right">1.792MB</td></tr><tr><td align="left">UBlock publicsuffix</td><td align="right">4.529 MB*</td><td align="right">2.399MB</td></tr><tr><td align="left">haraka-tld</td><td align="right">4.405 MB</td><td align="right">2.595MB</td></tr></tbody></table><p>(*) The memory of uBlock cannot be estimated correctly as for this benchmarks the lists were inlined in the source code, which is not how it’s used in production.</p><h1 id="loading-time">Loading Time</h1><p>One point of comparison which can make a difference in some contexts (e.g.: mobile or if the library is embedded in a website) is the loading time of the bundle itself (or time it takes to parse the code and initialize it). It can have a big impact if you use the library on very slow devices (like mobiles) and here again, not all the libraries are equal.</p><p>The benchmark code can be found in <a href="https://github.com/remusao/tldts/blob/master/comparison/bench_startup.sh">bench_startup.sh</a>. It measures the time it takes to import each of the libraries. The measurements are performed using the <a href="https://hackage.haskell.org/package/bench">bench</a> CLI, looking at the <code>mean</code> time returned for each.</p><p>Note that this benchmark was performed using the cjs bundle. The performance might be different in another environment or different bundle (e.g.: UMD in a browser).</p><table><thead><tr><th align="left">Library</th><th align="right">Mean (ms)</th></tr></thead><tbody><tr><td align="left">Ref (no <code>require</code>)</td><td align="right">48.21</td></tr><tr><td align="left"><strong>tldts-experimental</strong></td><td align="right"><strong>47.93</strong></td></tr><tr><td align="left">psl</td><td align="right">53.77</td></tr><tr><td align="left">tld.js</td><td align="right">58.74</td></tr><tr><td align="left">parse-domain</td><td align="right">61.96</td></tr><tr><td align="left">tldts</td><td align="right">64.48</td></tr><tr><td align="left">ublock</td><td align="right">78.05</td></tr><tr><td align="left">haraka-tld</td><td align="right">84.93</td></tr></tbody></table><p>Note that some libraries like <code>ublock</code> or <code>haraka-tld</code> perform some form of parsing of the rules at loading-time, which incurs an initial cost when importing the library.</p><h1 id="bundles">Bundles</h1><p>Comparison of bundle sizes, when applicable (not all libraries provide bundles):</p><table><thead><tr><th align="left">Library</th><th align="right">Normal</th><th align="right">Minified</th><th align="right">Gzipped</th></tr></thead><tbody><tr><td align="left"><strong>tldts-experimental</strong></td><td align="right"><strong>100KB</strong></td><td align="right"><strong>94KB</strong></td><td align="right">38KB</td></tr><tr><td align="left">tldts</td><td align="right">140KB</td><td align="right"><strong>95KB</strong></td><td align="right">37KB</td></tr><tr><td align="left">psl</td><td align="right">138KB</td><td align="right">122KB</td><td align="right">39KB</td></tr><tr><td align="left">tld.js</td><td align="right">209KB</td><td align="right">141KB</td><td align="right">40KB</td></tr><tr><td align="left">parse-domain</td><td align="right">?</td><td align="right">?</td><td align="right">?</td></tr><tr><td align="left">ublock</td><td align="right">?</td><td align="right">?</td><td align="right">?</td></tr><tr><td align="left">haraka-tld</td><td align="right">?</td><td align="right">?</td><td align="right">?</td></tr></tbody></table><h1 id="dependencies">Dependencies</h1><p>Here is a comparison of dependencies for each library:</p><table><thead><tr><th align="left">Library</th><th align="left">Dependencies</th></tr></thead><tbody><tr><td align="left"><strong>tldts</strong></td><td align="left"><strong>(none)</strong></td></tr><tr><td align="left">psl</td><td align="left">punycode</td></tr><tr><td align="left">tld.js</td><td align="left">punycode</td></tr><tr><td align="left">ublock</td><td align="left">punycode</td></tr><tr><td align="left">haraka-tld</td><td align="left">punycode</td></tr><tr><td align="left">parse-domain</td><td align="left">?</td></tr></tbody></table><h1 id="conclusion">Conclusion</h1><p>=&gt; <a href="https://github.com/remusao/tldts"><strong>Tldts GitHub repository</strong></a></p><p>=&gt; <a href="https://www.npmjs.com/package/tldts"><strong>Tldts on NPM</strong></a></p><pre><code class="language-sh">npm install tldts</code></pre><p>If that sounds appealing to you, give it a shot and do not hesite to open issues for any feedback you might have!</p></div><div class="comments"><span><a class="leave-comment-btn" href="https://github.com/remusao/remusao.github.io/issues/17" title="https://github.com/remusao/remusao.github.io/issues/17" target="_blank" rel="noopener noreferrer">Leave a comment on GitHub</a></span></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io//posts/tldts-benchmarks.html&t=Fast domains and URLs parsing with tldts" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Share on Facebook" src="/images/social_flat_rounded_rects_svg/Facebook.svg"><a></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io//posts/tldts-benchmarks.html&text=Fast domains and URLs parsing with tldts&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Tweet" src="/images/social_flat_rounded_rects_svg/Twitter.svg"><a></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io//posts/tldts-benchmarks.html&title=Fast domains and URLs parsing with tldts" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Add to Pocket" src="/images/social_flat_rounded_rects_svg/Pocket.svg"><a></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io//posts/tldts-benchmarks.html&t=Fast domains and URLs parsing with tldts" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Hacker News" src="/images/social_flat_rounded_rects_svg/HackerNews.svg"><a></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io//posts/tldts-benchmarks.html&title=Fast domains and URLs parsing with tldts" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Reddit" src="/images/social_flat_rounded_rects_svg/Reddit.svg"><a></a></li></ul></div></footer></main></body></html>