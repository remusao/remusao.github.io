<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Packaging Node.js apps the easy way</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/packaging-nodejs-apps.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1{line-height:1.1em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}h1,h2,h3{padding-top:.7em}.header{color:#555;margin-top:-.8em}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;font-style:italic;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{display:block;overflow-x:auto}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.share img{width:2em}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>Packaging Node.js apps the easy way</h1><section class="header"><div>└─ 2018-03-04 • <em>Reading time: ~5 minutes</em></div></section><article><div class="main"><p><em>TL;DR</em> in this article we demonstrate how to:</p><ul><li>Create a minified bundle for a Node.js application (using Webpack 4).</li><li>Create a self-contained executable (using Nexe).</li><li>Create a Docker containers to run the application.</li></ul><p>…without any configuration file!</p><p>Packaging, bundling, deploying Node.js applications can get very tricky when you are faced with the diversity of tools that can be used. Even when tools have been chosen, configuration is often non-trivial.</p><p>In this post we will see that packaging a Node.js application does not have to be difficult or confusing. By sticking to a minimal set of tools and using just the necessary configuration, we will be able to create the following artifacts: minified bundle, self-contained executable, Docker image.</p><p>All the code from this article can be found <a href="https://github.com/remusao/node-app-packaging-template">on GitHub</a>.</p><h2 id="the-application">The Application</h2><p>Our demonstration application is performing a bandwidth test with <code>fast.com</code>, using <code>jsdom</code> to avoid having to resort to a headless browser. The output looks like the following:</p><pre><code class="language-js">$ node index.js
Starting bandwidth test...
~ Speed <span class="hljs-number">0</span>
~ Speed <span class="hljs-number">7.9</span> Mbps
~ Speed <span class="hljs-number">35</span> Mbps
~ Speed <span class="hljs-number">60</span> Mbps
~ Speed <span class="hljs-number">60</span> Mbps
~ Speed <span class="hljs-number">64</span> Mbps
~ Speed <span class="hljs-number">65</span> Mbps
~ Speed <span class="hljs-number">67</span> Mbps

= Speed <span class="hljs-number">66</span> Mbps</code></pre><p>The implementation details are not really relevant, but long story short; <code>jsdom</code> is loading the URL <code>https://fast.com</code>. We then display the bandwidth estimation every second until the test is completed.</p><h2 id="bundling-with-webpack">Bundling with Webpack</h2><p>In the past, I found Webpack to be a bit cumbersome to use, even for simple use-cases. With version 4, I was delighted to see that they now provide meaningful defaults and simple options. In our case, it is not even necessary to have a configuration file, which is great!</p><p>Producing a minified bundle is as simple as:</p><pre><code class="language-sh">$ webpack index.js --output bundle.min.js --mode production --target node</code></pre><p>That’s it! This command will create a new file: <code>bundle.min.js</code> in the current directory. Since the <code>--target</code> is Node.js, we can invoke it directly: <code>node bundle.min.js</code>.</p><p>If you want faster builds as well as a watch-mode, you can use the following variations of the previous command:</p><pre><code class="language-sh">$ webpack index.js --output bundle.min.js --mode development --target node
$ webpack index.js --output bundle.min.js --mode development --watch --target node</code></pre><p>Yes, it’s <em>that easy</em>!</p><h2 id="compiling-into-a-single-executable">Compiling into a Single Executable</h2><p>We could have stopped at our minified bundle, but what if we could get a self-contained executable packaging our application as well as all dependencies? And by dependencies, we really mean: Node.js itself and everything needed for the runtime.</p><p>It’s possible thanks to <a href="https://github.com/nexe/nexe">Nexe</a>, which provides a way to <em>compile</em> your Javascript application along with a Node.js runtime in a single executable. Neat.</p><p>With our already existing bundle <code>bundle.min.js</code>, a single command is needed to create the executable:</p><pre><code class="language-sh">$ nexe bundle.min.js -t alpine-x64-8.9.3 -o app</code></pre><p>What we’re saying here is that our <code>bundle.min.js</code> should be compiled with a Node.js runtime version 8.9.3 compiled for Alpine Linux x64 (which will be useful in a moment to create a Docker image). You can also check the <a href="https://github.com/nexe/nexe/releases/tag/v2.0.0-rc.17">exhaustive list of all possible targets</a></p><p>You should now have a new executable in your current folder: <code>app</code>. It can be started by invoking it like any other command:</p><pre><code class="language-sh">$ ./app</code></pre><h2 id="building-docker-images">Building Docker Images</h2><p>And now the cherry on the cake! Although you can already easily ship your self-contained application created using Nexe, why not create a Docker container out of it? This can be achieved with the following <code>Dockerfile</code>:</p><pre><code class="language-sh">FROM alpine:3.7
COPY ./app .</code></pre><p>Building:</p><pre><code class="language-sh">$ docker build -t app .</code></pre><p>The resulting image should weigh around 44MB. And here is how to run the application:</p><pre><code class="language-sh">$ docker run app ./app
Starting bandwidth <span class="hljs-built_in">test</span>...
...

= Speed 66 Mbps</code></pre><h2 id="final-thoughts">Final Thoughts</h2><p>I will not pretend that the tools described here are able to handle all use-cases (or that they are the only possible tools; there are a plethora!), far from it. It is mostly restricted to simple Node.js applications (with dependencies). But this is probably a nice starting point for more complex situations, for which you might need to create a proper configuration file with more bells and whistles.</p><p>The ease with which complex tasks can be handled with simple commands and almost no configuration also shows that the Node.js/Javascript ecosystem is maturing! Although there is still a lot of fragmentation, it’s really nice to observe and benefit from all these improvements.</p></div><div class="comments"><span><a class="leave-comment-btn" href="https://github.com/remusao/remusao.github.io/issues/10" title="https://github.com/remusao/remusao.github.io/issues/10" target="_blank" rel="noopener noreferrer">Leave a comment on GitHub</a></span><details><summary>1 comment</summary><ul class="comments-list"><li><div class="comment"><div class="meta"><img loading="lazy" class="avatar" src="https://avatars0.githubusercontent.com/u/2523576?v=4" width="40" height="40"> <a class="author" href="https://github.com/ricardoaat" title="ricardoaat" target="_blank" rel="noopener noreferrer">ricardoaat</a> <span>commented </span><a class="date" href="https://github.com/remusao/remusao.github.io/issues/10#issuecomment-371099160" title="https://github.com/remusao/remusao.github.io/issues/10#issuecomment-371099160" target="_blank" rel="noopener noreferrer">2 years ago</a></div><div class="content"><p>This was exactly what i was looking for! very good explanation and examples.</p><p>Thanks !</p></div></div></li></ul></details></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io//posts/packaging-nodejs-apps.html&t=Packaging Node.js apps the easy way" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Share on Facebook" src="/images/social_flat_rounded_rects_svg/Facebook.svg"><a></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io//posts/packaging-nodejs-apps.html&text=Packaging Node.js apps the easy way&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Tweet" src="/images/social_flat_rounded_rects_svg/Twitter.svg"><a></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io//posts/packaging-nodejs-apps.html&title=Packaging Node.js apps the easy way" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Add to Pocket" src="/images/social_flat_rounded_rects_svg/Pocket.svg"><a></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io//posts/packaging-nodejs-apps.html&t=Packaging Node.js apps the easy way" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Hacker News" src="/images/social_flat_rounded_rects_svg/HackerNews.svg"><a></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io//posts/packaging-nodejs-apps.html&title=Packaging Node.js apps the easy way" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Reddit" src="/images/social_flat_rounded_rects_svg/Reddit.svg"><a></a></li></ul></div></footer></main></body></html>