<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Pytestâ€”Paramaterize tests with external data</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/pytest-param.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">.sharing-facebook{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%233b5998%22%2F%3E%3Cpath%20d%3D%22M17.936%2028.5V17.096h3.827l.574-4.444h-4.402V9.815c0-1.287.358-2.164%202.203-2.164h2.353V3.675c-.407-.055-1.804-.176-3.43-.176-3.392%200-5.715%202.072-5.715%205.875v3.278H9.51v4.443h3.838V28.5z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-pocket,.sharing-twitter{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%2300abf1%22%2F%3E%3Cpath%20d%3D%22M28.5%208.246a10.249%2010.249%200%2001-2.945.808%205.148%205.148%200%20002.255-2.837%2010.272%2010.272%200%2001-3.258%201.244%205.12%205.12%200%2000-3.743-1.62%205.13%205.13%200%2000-4.997%206.299A14.562%2014.562%200%20015.241%206.78a5.104%205.104%200%2000-.695%202.579%205.125%205.125%200%20002.282%204.269%205.115%205.115%200%2001-2.323-.641v.064a5.133%205.133%200%20004.114%205.03%205.163%205.163%200%2001-1.351.18c-.33%200-.653-.034-.966-.093a5.134%205.134%200%20004.791%203.562%2010.288%2010.288%200%2001-6.37%202.195c-.413%200-.821-.024-1.223-.072a14.516%2014.516%200%20007.863%202.305c9.434%200%2014.593-7.816%2014.593-14.593%200-.223-.006-.444-.015-.664a10.427%2010.427%200%20002.56-2.655z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-pocket{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23e84352%22%2F%3E%3Cpath%20d%3D%22M24.297%205.554H7.703c-1.631%200-2.953%201.332-2.953%202.976v8.243c0%20.153.012.303.034.45a6.366%206.366%200%2000-.034.666c0%204.725%205.037%208.557%2011.25%208.557s11.25-3.832%2011.25-8.557a6.71%206.71%200%2000-.034-.666c.022-.147.034-.297.034-.45V8.53c0-1.644-1.324-2.976-2.953-2.976zM22.9%2013.841l-5.811%205.81a1.49%201.49%200%2001-1.07.438%201.489%201.489%200%2001-1.107-.438l-5.81-5.81a1.494%201.494%200%20012.112-2.112L16%2016.516l4.787-4.787a1.494%201.494%200%20012.112%200%201.493%201.493%200%20010%202.112z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E)}.sharing-hackernews,.sharing-reddit{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23f68423%22%2F%3E%3Cpath%20d%3D%22M6.796%204.124l7.656%2015.157v8.595h3.114V19.28l7.638-15.157h-3.382l-5.82%2011.412-5.598-11.412z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-reddit{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23ef4623%22%2F%3E%3Cpath%20d%3D%22M21.374%2016.93a1.385%201.385%200%2001.094.504c0%20.34-.118.672-.315.942a1.495%201.495%200%2001-.798.565l-.006.002-.004.002a1.428%201.428%200%2001-.464.076%201.648%201.648%200%2001-1.006-.354%201.513%201.513%200%2001-.566-.92v-.005l-.001-.003a1.382%201.382%200%2001-.031-.293c0-.328.112-.643.296-.903a1.553%201.553%200%2001.746-.57h.003l.002-.002a1.535%201.535%200%2001.533-.096%201.664%201.664%200%2001.919.28c.268.178.485.44.595.764l.002.006.002.005h-.001zm-1%204.027a.797.797%200%2000-.432-.134.679.679%200%2000-.375.114%207.275%207.275%200%2001-3.693%201.02c-.968%200-1.93-.203-2.8-.632l-.005-.002-.005-.001c-.13-.054-.28-.168-.444-.278a1.653%201.653%200%2000-.266-.146.795.795%200%2000-.312-.07.697.697%200%2000-.288.066l-.015.006a.702.702%200%2000-.347.29.834.834%200%2000-.02.825.71.71%200%2000.286.287c1.246.84%202.712%201.221%204.185%201.22a9.127%209.127%200%20003.852-.867l.006-.003.006-.003c.157-.093.365-.176.562-.298a1.27%201.27%200%2000.273-.226.856.856%200%2000.184-.342.697.697%200%2000-.05-.486.845.845%200%2000-.301-.34zm-8.744-2.02a.022.022%200%2001.007.002%201.412%201.412%200%2000.486.087c.404%200%20.798-.166%201.095-.436a1.48%201.48%200%2000.502-1.091c0-.012%200-.023-.002-.037a1.168%201.168%200%2000.002-.063c0-.433-.2-.818-.495-1.09a1.63%201.63%200%2000-1.094-.44c-.109%200-.22.014-.328.039h-.006a1.592%201.592%200%2000-1.184%201.062v.002a1.458%201.458%200%2000-.073.459c0%20.336.111.664.303.934a1.5%201.5%200%2000.787.573zm16.865-3.924v.002a3.084%203.084%200%2001-.515%201.85%203.389%203.389%200%2001-1.203%201.115c.03.241.049.485.049.728a6.026%206.026%200%2001-1.237%203.623h-.002c-1.451%201.93-3.68%203.069-5.93%203.643l-.003.002a15.582%2015.582%200%2001-3.674.44%2014.52%2014.52%200%2001-5.406-1.022v-.002h-.002c-1.783-.734-3.482-1.902-4.523-3.613a5.892%205.892%200%2001-.869-3.061c0-.243.017-.487.05-.729a3.49%203.49%200%2001-1.178-1.086%203.201%203.201%200%2001-.552-1.639v-.009c0-.833.362-1.623.925-2.204.563-.582%201.33-.962%202.154-.962h.035a3.714%203.714%200%2001.261-.01%203.408%203.408%200%20011.223.219l.002.001h.002a4.1%204.1%200%2001.968.55c.096-.051.202-.108.32-.153%201.806-1.07%203.904-1.482%205.95-1.6.018-1.014.142-2.074.636-3.003.412-.77%201.126-1.371%201.977-1.579l.003-.002h.004a5.132%205.132%200%2001.975-.092c.864%200%201.718.205%202.517.524.354-.533.859-.95%201.452-1.184l.005-.003.006-.002a3.665%203.665%200%20011.083-.172c.39%200%20.781.07%201.149.235l.008.002c.527.203.972.578%201.288%201.043.316.469.502%201.029.502%201.605a2.756%202.756%200%2001-.018.32l-.001.001v.006c-.063.744-.44%201.397-.973%201.863a2.995%202.995%200%2001-1.947.75%202.85%202.85%200%2001-.345-.02c-.708-.055-1.369-.398-1.854-.908-.486-.508-.8-1.189-.8-1.922%200-.035.004-.072.005-.107-.665-.296-1.37-.542-2.072-.541a2.8%202.8%200%2000-.304.016h-.002a1.586%201.586%200%2000-1.25.857v.002c-.358.7-.43%201.517-.442%202.33%202.014.13%204.04.614%205.815%201.635h.003l.026.014c.033.02.096.055.152.085.122-.1.25-.201.399-.289a3.279%203.279%200%20011.814-.537c.283%200%20.567.036.842.107h.001l.012.003.01.002a3.36%203.36%200%20011.68%201.043c.443.504.74%201.14.799%201.834zm-5.93-6.589c0%20.027%200%20.055.003.084v.005c.013.35.178.675.43.915.251.24.586.39.926.391h.008c.025.002.05.002.073.002.343%200%20.683-.147.939-.387.256-.24.425-.568.438-.92v-.005a.793.793%200%2000.004-.08c0-.362-.17-.709-.436-.965a1.43%201.43%200%2000-.972-.414%201.1%201.1%200%2000-.336.05h-.007a1.485%201.485%200%2000-.756.492%201.315%201.315%200%2000-.315.832zM7.702%2013.821c-.27-.125-.547-.215-.822-.213a1.093%201.093%200%2000-.14.007h-.006l-.006.002a1.72%201.72%200%2000-1.094.458%201.522%201.522%200%2000-.512%201.056v.008a1.226%201.226%200%2000-.004.097c0%20.253.077.497.21.719.096.165.223.317.368.448.461-1.01%201.183-1.869%202.006-2.582zm17.54%204.944c0-.901-.326-1.806-.853-2.535-1.049-1.46-2.676-2.412-4.37-2.943l-.011-.004a13.78%2013.78%200%2000-.984-.263%2013.603%2013.603%200%2000-3.018-.338%2013.675%2013.675%200%2000-4.025.603c-1.693.537-3.326%201.483-4.373%202.948v.001a4.397%204.397%200%2000-.842%202.544c0%20.333.042.665.13.99h.001c.19.727.563%201.376%201.046%201.941a7.521%207.521%200%20001.696%201.444%2011.725%2011.725%200%2000.418.246c1.807%201.008%203.888%201.45%205.954%201.45.35%200%20.7-.012%201.048-.037%202.08-.171%204.17-.786%205.859-2.04v-.002a6.567%206.567%200%20001.43-1.425%204.62%204.62%200%2000.814-1.824v-.003a3.577%203.577%200%2000.079-.753zm1.641-3.585a1.345%201.345%200%2000-.16-.64l-.002-.002-.002-.004a1.562%201.562%200%2000-.653-.684%201.897%201.897%200%2000-.928-.236%201.9%201.9%200%2000-.846.197c.826.717%201.55%201.58%202.02%202.594a1.692%201.692%200%2000.375-.47c.125-.234.196-.496.196-.755z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E)}body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1{line-height:1.1em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}h1,h2,h3{padding-top:.7em}.header{color:#555;margin-top:-.8em}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;font-style:italic;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{display:block;overflow-x:auto}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.sharing{display:inline-block;height:32px;width:32px}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>Pytestâ€”Paramaterize tests with external data</h1><section class="header"><div>â””â”€ 2014-11-26 â€¢ <em>Reading time: ~6 minutes</em></div></section><article><div class="main"><p>I recently began to make heavy use of <a href="http://pytest.org/latest/" target="_blank" rel="noopener noreferrer">pytest</a> in my day-to-day Python development. Itâ€™s a wonderful tool, but I wonâ€™t explain to you every features it provides and why itâ€™s awesome. Instead, Iâ€™ll explain how I managed to cleanly externalize the data used for my tests in external files (that can be of any format: yaml, json, python files). The idea here is to <em>separate the code that performs the test</em>, from the <em>input data used to perform the test</em>.</p><ul><li><em>test_feature.py</em></li></ul><pre class="code" data-lang="python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_my_feature</span>(<span class="hljs-params">one_example</span>):</span>
    <span class="hljs-keyword">assert</span> one_example
</code></pre><ul><li><em>data_feature.yaml</em></li></ul><pre class="code" data-lang="yaml"><code><span class="hljs-attr">tests:</span>
    <span class="hljs-attr">test1:</span>
        <span class="hljs-string">...</span>
    <span class="hljs-attr">test2:</span>
        <span class="hljs-string">...</span>
</code></pre><h2>First solution: yield</h2><p>The first solution would be to use <code>yield</code> to generate tests, as itâ€™s supported by <code>py.test</code> (as long as you donâ€™t want to use fixtures in your test functionâ€¦).</p><pre class="code" data-lang="python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span>(<span class="hljs-params">example</span>):</span>
    <span class="hljs-comment"># perform your test</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_feature</span>():</span>
    <span class="hljs-keyword">for</span> test <span class="hljs-keyword">in</span> generate_tests():
        <span class="hljs-keyword">yield</span> check, test
</code></pre><p>Here, <code>py.test</code> will understand that <code>test_feature</code> will yield several tests and that the <code>check</code> function must be used to perform the test, so it is almost equivalent to do:</p><pre class="code" data-lang="python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_feature</span>():</span>
    <span class="hljs-keyword">for</span> test <span class="hljs-keyword">in</span> generate_tests():
        check(test)
</code></pre><p>Except that in this last snippet of code, the tests will stop as soon as one fails. With the <code>yield</code>-version, every tests will be ran even if some fail. This is useful if you have lot of tests, and you want to know which ones fail (not just the first one).</p><p><strong>Problem</strong>: if you want to use fixtures with your <code>test_feature</code> functions, it breaks:</p><pre class="code" data-lang="python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span>(<span class="hljs-params">example</span>):</span>
    <span class="hljs-comment"># perform your test</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_feature</span>(<span class="hljs-params">my_fixture</span>):</span>
    <span class="hljs-keyword">for</span> test <span class="hljs-keyword">in</span> generate_tests():
        <span class="hljs-keyword">yield</span> check, test
</code></pre><p>This will tell you that <code>test_feature</code> expects one argument but that none are provided.</p><p>End of the storyâ€¦ Wait, no, <code>py.test</code> is awesome remember? So there must be a solution!</p><h2>Parametrization</h2><p>One of the cool features of <code>py.test</code> is the ability to add parameters on our tests or fixtures, so that a test is ran once for each parameter (from <a href="http://pytest.org/latest/parametrize.html" target="_blank" rel="noopener noreferrer">py.test doc</a>):</p><pre class="code" data-lang="python"><code><span class="hljs-comment"># content of test_expectation.py</span>
<span class="hljs-keyword">import</span> pytest
<span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;input,expected&quot;</span>, [
    (<span class="hljs-params"><span class="hljs-string">&quot;3+5&quot;</span>, <span class="hljs-number">8</span></span>),
    (<span class="hljs-params"><span class="hljs-string">&quot;2+4&quot;</span>, <span class="hljs-number">6</span></span>),
    (<span class="hljs-params"><span class="hljs-string">&quot;6*9&quot;</span>, <span class="hljs-number">42</span></span>),
]</span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_eval</span>(<span class="hljs-params"><span class="hljs-built_in">input</span>, expected</span>):</span>
    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">eval</span>(<span class="hljs-built_in">input</span>) == expected
</code></pre><pre class="code" data-lang="python"><code>$ py.test
=========================== test session starts ============================
platform linux -- Python <span class="hljs-number">3.4</span><span class="hljs-number">.0</span> -- py-<span class="hljs-number">1.4</span><span class="hljs-number">.26</span> -- pytest-<span class="hljs-number">2.6</span><span class="hljs-number">.4</span>
collected <span class="hljs-number">3</span> items

test_expectation.py ..F

================================= FAILURES =================================
____________________________ test_eval[<span class="hljs-number">6</span>*<span class="hljs-number">9</span>-<span class="hljs-number">42</span>] _____________________________

<span class="hljs-built_in">input</span> = <span class="hljs-string">&#x27;6*9&#x27;</span>, expected = <span class="hljs-number">42</span>

<span class="hljs-meta">    @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;input,expected&quot;</span>, [
        (<span class="hljs-params"><span class="hljs-string">&quot;3+5&quot;</span>, <span class="hljs-number">8</span></span>),
        (<span class="hljs-params"><span class="hljs-string">&quot;2+4&quot;</span>, <span class="hljs-number">6</span></span>),
        (<span class="hljs-params"><span class="hljs-string">&quot;6*9&quot;</span>, <span class="hljs-number">42</span></span>),
    ]</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_eval</span>(<span class="hljs-params"><span class="hljs-built_in">input</span>, expected</span>):</span>
&gt;       <span class="hljs-keyword">assert</span> <span class="hljs-built_in">eval</span>(<span class="hljs-built_in">input</span>) == expected
E       <span class="hljs-keyword">assert</span> <span class="hljs-number">54</span> == <span class="hljs-number">42</span>
E        +  where <span class="hljs-number">54</span> = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;6*9&#x27;</span>)

test_expectation.py:<span class="hljs-number">8</span>: AssertionError
==================== <span class="hljs-number">1</span> failed, <span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span> seconds ====================
</code></pre><p>So here our <code>test_eval</code> function has been called <em>three times</em>. Once for each parameter. Great! But what if you want your parameters to come from another file, or from a function. In other words, what if you want to <em>dynamically parametrize</em> your function?</p><h2>Hooks at the rescue</h2><p><a href="http://pytest.org/latest/plugins.html#well-specified-hooks" target="_blank" rel="noopener noreferrer">Hooks</a> allow you to plug code into <code>py.test</code> at diffent stages of the test run. The hook that can be useful for us is <code>pytest_generate_tests</code> that will allow to generate several calls to the same test function, but with different arguments (from <a href="http://pytest.org/latest/funcargs.html#basic-generated-test-example" target="_blank" rel="noopener noreferrer">py.test doc</a>):</p><pre class="code" data-lang="python"><code><span class="hljs-comment"># content of test_example.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pytest_generate_tests</span>(<span class="hljs-params">metafunc</span>):</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;numiter&quot;</span> <span class="hljs-keyword">in</span> metafunc.funcargnames:
        metafunc.parametrize(<span class="hljs-string">&quot;numiter&quot;</span>, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_func</span>(<span class="hljs-params">numiter</span>):</span>
    <span class="hljs-keyword">assert</span> numiter &lt; <span class="hljs-number">9</span>
</code></pre><pre class="code" data-lang="python"><code>$ py.test test_example.py
=========================== test session starts ============================
platform linux2 -- Python <span class="hljs-number">2.7</span><span class="hljs-number">.1</span> -- pytest-<span class="hljs-number">2.2</span><span class="hljs-number">.4</span>
collecting ... collected <span class="hljs-number">10</span> items

test_example.py .........F

================================= FAILURES =================================
_______________________________ test_func[<span class="hljs-number">9</span>] _______________________________

numiter = <span class="hljs-number">9</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_func</span>(<span class="hljs-params">numiter</span>):</span>
&gt;       <span class="hljs-keyword">assert</span> numiter &lt; <span class="hljs-number">9</span>
E       <span class="hljs-keyword">assert</span> <span class="hljs-number">9</span> &lt; <span class="hljs-number">9</span>

test_example.py:<span class="hljs-number">6</span>: AssertionError
==================== <span class="hljs-number">1</span> failed, <span class="hljs-number">9</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.02</span> seconds ====================
</code></pre><p>Great, so the last things to do is:</p><ol><li>Detect functions that make use of a fixture whose name starts with <code>data_</code></li><li>Load the corresponding file or resource for the test source</li><li>Parametrize the function with each of the data</li></ol><p>For example, here is what you can do:</p><pre class="code" data-lang="python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pytest_generate_tests</span>(<span class="hljs-params">metafunc</span>):</span>
    <span class="hljs-string">&quot;&quot;&quot; This allows us to load tests from external files by
    parametrizing tests with each test case found in a data_X
    file &quot;&quot;&quot;</span>
    <span class="hljs-keyword">for</span> fixture <span class="hljs-keyword">in</span> metafunc.fixturenames:
        <span class="hljs-keyword">if</span> fixture.startswith(<span class="hljs-string">&#x27;data_&#x27;</span>):
            <span class="hljs-comment"># Load associated test data</span>
            tests = load_tests(fixture)
            metafunc.parametrize(fixture, tests)
</code></pre><p>Here, the <code>load_tests</code> function takes as argument the name of the fixture <code>data_X</code> and will:</p><ol><li>Load the corresponding file</li><li>Extract the different test-cases</li><li>Return a list of all the cases</li></ol><p>For example, if your tests are stored in a Python file:</p><pre class="code" data-lang="python"><code><span class="hljs-keyword">import</span> importlib


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_tests</span>(<span class="hljs-params">name</span>):</span>
    <span class="hljs-comment"># Load module which contains test data</span>
    tests_module = importlib.import_module(name)
    <span class="hljs-comment"># Tests are to be found in the variable `tests` of the module</span>
    <span class="hljs-keyword">for</span> test <span class="hljs-keyword">in</span> tests_module.tests.iteritems():
        <span class="hljs-keyword">yield</span> test
</code></pre><p>The data file (<code>data_my_feature.py</code>) could look something like:</p><pre class="code" data-lang="python"><code>tests = [
    <span class="hljs-number">1</span>,
    <span class="hljs-number">2</span>,
    <span class="hljs-number">3</span>,
    <span class="hljs-number">4</span>,
    <span class="hljs-number">5</span>,
    <span class="hljs-number">6</span>,
    <span class="hljs-number">7</span>,
    <span class="hljs-number">8</span>,
    <span class="hljs-number">9</span>
]
</code></pre><p>The test function will then be invoked for each case.</p><pre class="code" data-lang="python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_feature</span>(<span class="hljs-params">data_my_feature</span>):</span>
    <span class="hljs-keyword">assert</span> data_my_feature &lt; <span class="hljs-number">5</span>
</code></pre><h2>Conclusion</h2><p>Here itâ€™s not really interesting, but the benefits are numerous:</p><ol><li>storing your data in a database, or in yaml/json formatted files, or whatever</li><li>other people can add tests to your project, without having to dig into the code</li><li>provide a common format to define tests in external files</li><li>reuse the same data for several tests</li><li>the data is not hard-coded in Python source-code</li></ol><p>TL;DR: <code>py.test</code> is awesome. Make tests. Get data for your tests from external sources.</p></div><div class="comments"></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io//posts/pytest-param.html&t=Pytestâ€”Paramaterize tests with external data" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-facebook"></div></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io//posts/pytest-param.html&text=Pytestâ€”Paramaterize tests with external data&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-twitter"></div></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io//posts/pytest-param.html&title=Pytestâ€”Paramaterize tests with external data" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-pocket"></div></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io//posts/pytest-param.html&t=Pytestâ€”Paramaterize tests with external data" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-hackernews"></div></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io//posts/pytest-param.html&title=Pytestâ€”Paramaterize tests with external data" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-reddit"></div></a></li></ul></div></footer></main></body></html>