<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>A tour of IHaskell extensions</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/ihashell-extensions-tour.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">.sharing-facebook{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%233b5998%22%2F%3E%3Cpath%20d%3D%22M17.936%2028.5V17.096h3.827l.574-4.444h-4.402V9.815c0-1.287.358-2.164%202.203-2.164h2.353V3.675c-.407-.055-1.804-.176-3.43-.176-3.392%200-5.715%202.072-5.715%205.875v3.278H9.51v4.443h3.838V28.5z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-pocket,.sharing-twitter{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%2300abf1%22%2F%3E%3Cpath%20d%3D%22M28.5%208.246a10.249%2010.249%200%2001-2.945.808%205.148%205.148%200%20002.255-2.837%2010.272%2010.272%200%2001-3.258%201.244%205.12%205.12%200%2000-3.743-1.62%205.13%205.13%200%2000-4.997%206.299A14.562%2014.562%200%20015.241%206.78a5.104%205.104%200%2000-.695%202.579%205.125%205.125%200%20002.282%204.269%205.115%205.115%200%2001-2.323-.641v.064a5.133%205.133%200%20004.114%205.03%205.163%205.163%200%2001-1.351.18c-.33%200-.653-.034-.966-.093a5.134%205.134%200%20004.791%203.562%2010.288%2010.288%200%2001-6.37%202.195c-.413%200-.821-.024-1.223-.072a14.516%2014.516%200%20007.863%202.305c9.434%200%2014.593-7.816%2014.593-14.593%200-.223-.006-.444-.015-.664a10.427%2010.427%200%20002.56-2.655z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-pocket{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23e84352%22%2F%3E%3Cpath%20d%3D%22M24.297%205.554H7.703c-1.631%200-2.953%201.332-2.953%202.976v8.243c0%20.153.012.303.034.45a6.366%206.366%200%2000-.034.666c0%204.725%205.037%208.557%2011.25%208.557s11.25-3.832%2011.25-8.557a6.71%206.71%200%2000-.034-.666c.022-.147.034-.297.034-.45V8.53c0-1.644-1.324-2.976-2.953-2.976zM22.9%2013.841l-5.811%205.81a1.49%201.49%200%2001-1.07.438%201.489%201.489%200%2001-1.107-.438l-5.81-5.81a1.494%201.494%200%20012.112-2.112L16%2016.516l4.787-4.787a1.494%201.494%200%20012.112%200%201.493%201.493%200%20010%202.112z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E)}.sharing-hackernews,.sharing-reddit{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23f68423%22%2F%3E%3Cpath%20d%3D%22M6.796%204.124l7.656%2015.157v8.595h3.114V19.28l7.638-15.157h-3.382l-5.82%2011.412-5.598-11.412z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E);background-repeat:no-repeat}.sharing-reddit{background-image:url(data:image/svg+xml;utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%2232%22%20width%3D%2232%22%3E%3Crect%20height%3D%2232%22%20rx%3D%224%22%20ry%3D%224%22%20width%3D%2232%22%20fill%3D%22%23ef4623%22%2F%3E%3Cpath%20d%3D%22M21.374%2016.93a1.385%201.385%200%2001.094.504c0%20.34-.118.672-.315.942a1.495%201.495%200%2001-.798.565l-.006.002-.004.002a1.428%201.428%200%2001-.464.076%201.648%201.648%200%2001-1.006-.354%201.513%201.513%200%2001-.566-.92v-.005l-.001-.003a1.382%201.382%200%2001-.031-.293c0-.328.112-.643.296-.903a1.553%201.553%200%2001.746-.57h.003l.002-.002a1.535%201.535%200%2001.533-.096%201.664%201.664%200%2001.919.28c.268.178.485.44.595.764l.002.006.002.005h-.001zm-1%204.027a.797.797%200%2000-.432-.134.679.679%200%2000-.375.114%207.275%207.275%200%2001-3.693%201.02c-.968%200-1.93-.203-2.8-.632l-.005-.002-.005-.001c-.13-.054-.28-.168-.444-.278a1.653%201.653%200%2000-.266-.146.795.795%200%2000-.312-.07.697.697%200%2000-.288.066l-.015.006a.702.702%200%2000-.347.29.834.834%200%2000-.02.825.71.71%200%2000.286.287c1.246.84%202.712%201.221%204.185%201.22a9.127%209.127%200%20003.852-.867l.006-.003.006-.003c.157-.093.365-.176.562-.298a1.27%201.27%200%2000.273-.226.856.856%200%2000.184-.342.697.697%200%2000-.05-.486.845.845%200%2000-.301-.34zm-8.744-2.02a.022.022%200%2001.007.002%201.412%201.412%200%2000.486.087c.404%200%20.798-.166%201.095-.436a1.48%201.48%200%2000.502-1.091c0-.012%200-.023-.002-.037a1.168%201.168%200%2000.002-.063c0-.433-.2-.818-.495-1.09a1.63%201.63%200%2000-1.094-.44c-.109%200-.22.014-.328.039h-.006a1.592%201.592%200%2000-1.184%201.062v.002a1.458%201.458%200%2000-.073.459c0%20.336.111.664.303.934a1.5%201.5%200%2000.787.573zm16.865-3.924v.002a3.084%203.084%200%2001-.515%201.85%203.389%203.389%200%2001-1.203%201.115c.03.241.049.485.049.728a6.026%206.026%200%2001-1.237%203.623h-.002c-1.451%201.93-3.68%203.069-5.93%203.643l-.003.002a15.582%2015.582%200%2001-3.674.44%2014.52%2014.52%200%2001-5.406-1.022v-.002h-.002c-1.783-.734-3.482-1.902-4.523-3.613a5.892%205.892%200%2001-.869-3.061c0-.243.017-.487.05-.729a3.49%203.49%200%2001-1.178-1.086%203.201%203.201%200%2001-.552-1.639v-.009c0-.833.362-1.623.925-2.204.563-.582%201.33-.962%202.154-.962h.035a3.714%203.714%200%2001.261-.01%203.408%203.408%200%20011.223.219l.002.001h.002a4.1%204.1%200%2001.968.55c.096-.051.202-.108.32-.153%201.806-1.07%203.904-1.482%205.95-1.6.018-1.014.142-2.074.636-3.003.412-.77%201.126-1.371%201.977-1.579l.003-.002h.004a5.132%205.132%200%2001.975-.092c.864%200%201.718.205%202.517.524.354-.533.859-.95%201.452-1.184l.005-.003.006-.002a3.665%203.665%200%20011.083-.172c.39%200%20.781.07%201.149.235l.008.002c.527.203.972.578%201.288%201.043.316.469.502%201.029.502%201.605a2.756%202.756%200%2001-.018.32l-.001.001v.006c-.063.744-.44%201.397-.973%201.863a2.995%202.995%200%2001-1.947.75%202.85%202.85%200%2001-.345-.02c-.708-.055-1.369-.398-1.854-.908-.486-.508-.8-1.189-.8-1.922%200-.035.004-.072.005-.107-.665-.296-1.37-.542-2.072-.541a2.8%202.8%200%2000-.304.016h-.002a1.586%201.586%200%2000-1.25.857v.002c-.358.7-.43%201.517-.442%202.33%202.014.13%204.04.614%205.815%201.635h.003l.026.014c.033.02.096.055.152.085.122-.1.25-.201.399-.289a3.279%203.279%200%20011.814-.537c.283%200%20.567.036.842.107h.001l.012.003.01.002a3.36%203.36%200%20011.68%201.043c.443.504.74%201.14.799%201.834zm-5.93-6.589c0%20.027%200%20.055.003.084v.005c.013.35.178.675.43.915.251.24.586.39.926.391h.008c.025.002.05.002.073.002.343%200%20.683-.147.939-.387.256-.24.425-.568.438-.92v-.005a.793.793%200%2000.004-.08c0-.362-.17-.709-.436-.965a1.43%201.43%200%2000-.972-.414%201.1%201.1%200%2000-.336.05h-.007a1.485%201.485%200%2000-.756.492%201.315%201.315%200%2000-.315.832zM7.702%2013.821c-.27-.125-.547-.215-.822-.213a1.093%201.093%200%2000-.14.007h-.006l-.006.002a1.72%201.72%200%2000-1.094.458%201.522%201.522%200%2000-.512%201.056v.008a1.226%201.226%200%2000-.004.097c0%20.253.077.497.21.719.096.165.223.317.368.448.461-1.01%201.183-1.869%202.006-2.582zm17.54%204.944c0-.901-.326-1.806-.853-2.535-1.049-1.46-2.676-2.412-4.37-2.943l-.011-.004a13.78%2013.78%200%2000-.984-.263%2013.603%2013.603%200%2000-3.018-.338%2013.675%2013.675%200%2000-4.025.603c-1.693.537-3.326%201.483-4.373%202.948v.001a4.397%204.397%200%2000-.842%202.544c0%20.333.042.665.13.99h.001c.19.727.563%201.376%201.046%201.941a7.521%207.521%200%20001.696%201.444%2011.725%2011.725%200%2000.418.246c1.807%201.008%203.888%201.45%205.954%201.45.35%200%20.7-.012%201.048-.037%202.08-.171%204.17-.786%205.859-2.04v-.002a6.567%206.567%200%20001.43-1.425%204.62%204.62%200%2000.814-1.824v-.003a3.577%203.577%200%2000.079-.753zm1.641-3.585a1.345%201.345%200%2000-.16-.64l-.002-.002-.002-.004a1.562%201.562%200%2000-.653-.684%201.897%201.897%200%2000-.928-.236%201.9%201.9%200%2000-.846.197c.826.717%201.55%201.58%202.02%202.594a1.692%201.692%200%2000.375-.47c.125-.234.196-.496.196-.755z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E)}body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1{line-height:1.1em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}h1,h2,h3{padding-top:.7em}.header{color:#555;margin-top:-.8em}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;font-style:italic;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{border-radius:2%;display:block;overflow-x:auto;padding:10px}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.sharing{display:inline-block;height:32px;width:32px}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>A tour of IHaskell extensions</h1><section class="header"><div>└─ 2016-01-11 • <em>Reading time: ~12 minutes</em></div></section><article><div class="main"><h2>Introduction</h2><p>In my previous <a href="https://remusao.github.io/install-ihaskell-on-ubuntu-1404-with-stack.html" target="_blank" rel="noopener noreferrer">post</a>, I tried to provide a step-by-step explanation of how to install <a href="https://github.com/gibiansky/IHaskell" target="_blank" rel="noopener noreferrer">IHaskell</a> on Ubuntu 14.04 (Should also work on other versions). Now is time to start using it!</p><p>This post is not a quickstart on how to use IHaskell, as it has already been covered in the <a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/IHaskell.ipynb" target="_blank" rel="noopener noreferrer">official documentation</a>. And there are more advanced examples here:</p><ul><li><a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/Conjugate%20Gradient.ipynb" target="_blank" rel="noopener noreferrer">Conjugate Gradient</a></li><li><a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/Gradient-Descent.ipynb" target="_blank" rel="noopener noreferrer">Gradient Descent</a></li><li><a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/Homophones.ipynb" target="_blank" rel="noopener noreferrer">Homophones</a></li><li><a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/Static%20Canvas%20IHaskell%20Display.ipynb" target="_blank" rel="noopener noreferrer">Static Canvas IHaskell Display</a></li></ul><p>Instead, I’ll focus more on something a bit more mysterious for me: <em>displaying custom Haskell types in notebooks</em>. I’ll first try to give a quick explanation on how it works, and then give basic examples of the provided integrations with existing libraries (aeson, blaze, charts, diagrams, etc.). I’ll also try to show how to support your custom types.</p><p><strong>Disclaimer</strong>: Some of the information found in the post may be redundant with other sources (like official documentation, and in particular the last post in the list above: <em>Static Canvas IHaskell Display</em>), but I hope this post will bring value by giving an overview of what is possible with <em>IHaskell</em>, explained with the words of a newcomer. Comments and fixes would be greatly appreciated!</p><h2>How does it work?</h2><p>Jupyter allows you to embed arbitrary HTML, and this mechanism is used by IHaskell to display values in custom ways. The <code>IHaskellDisplay</code> typeclass is used to this effect. By providing an instance for your own types, they can be displayed in notebooks (we’ll see later that some extensions already exist to provide such display to known Haskell libraries). A <code>Display</code> can be of several types, but for now we will focus on <code>html</code> and <code>plain</code> (see <a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/Static%20Canvas%20IHaskell%20Display.ipynb" target="_blank" rel="noopener noreferrer">this notebook</a> for more information).</p><p>Note that you can provide several choices of display outputs so that your custom type can be display in notebooks <em>(html)</em> or console <em>(plain text)</em>, the frontend will then select the best choice.</p><pre class="code" data-lang="haskell"><code><span class="hljs-keyword">import</span> IHaskell.Display

<span class="hljs-comment">-- Custom data type</span>
<span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">Answer</span> = <span class="hljs-type">Answer</span></span>

<span class="hljs-comment">-- Make it &quot;displayable&quot;</span>
<span class="hljs-class"><span class="hljs-keyword">instance</span> <span class="hljs-type">IHaskellDisplay</span> <span class="hljs-type">Answer</span> <span class="hljs-keyword">where</span></span>
    <span class="hljs-comment">-- List of two kinds of Display: html and plain text</span>
    display value = return $ <span class="hljs-type">Display</span> [htmlDisplay, txtDisplay]
        <span class="hljs-keyword">where</span>
            <span class="hljs-comment">-- HTML Display</span>
            htmlDisplay = html <span class="hljs-string">&quot;&lt;div&gt;The answer is 42!&lt;/div&gt;&quot;</span>
            <span class="hljs-comment">-- Plain Text Display</span>
            txtDisplay = plain <span class="hljs-string">&quot;42&quot;</span>

<span class="hljs-comment">-- Display an instance of our type</span>
<span class="hljs-type">Answer</span>
</code></pre><blockquote><pre class="code" data-lang="sh"><code>The answer is 42!
</code></pre></blockquote><p>In the following sections we’ll see how to use some of the extensions officially provided by <em>IHaskell</em> to display types of known libraries. The packages we’ll need are:</p><ul><li>ihaskell-basic</li><li>ihaskell-aeson</li><li>ihaskell-blaze</li><li>ihaskell-charts</li><li>ihaskell-diagrams</li><li>ihaskell-magic</li></ul><p>You can install them using stack if you intend to try this out yourself:</p><pre class="code" data-lang="sh"><code>stack build             \
    ihaskell-basic      \
    ihaskell-aeson      \
    ihaskell-blaze      \
    ihaskell-charts     \
    ihaskell-diagrams   \
    ihaskell-magic
</code></pre><h2>ihaskell-basic</h2><p>IHaskell <a href="https://hackage.haskell.org/package/ihaskell-basic" target="_blank" rel="noopener noreferrer">basic</a> contains <em>“Instances of IHaskellDisplay for default prelude data types”</em>. Currently, only <code>Maybe</code> seems to be supported. Maybe some more <em>Displays</em> will be provided in the future?</p><p>Anyway, here is how you can use it, and what it looks like:</p><pre class="code" data-lang="haskell"><code><span class="hljs-comment">-- import IHaskell.Display.Basic</span>
<span class="hljs-type">Just</span> <span class="hljs-number">42</span>
<span class="hljs-type">Just</span> (<span class="hljs-type">Just</span> <span class="hljs-string">&quot;Foo Bar Baz&quot;</span>)
<span class="hljs-type">Nothing</span>
</code></pre><blockquote><pre class="code" data-lang="haskell"><code><span class="hljs-type">Just</span> <span class="hljs-number">42</span>
<span class="hljs-type">Just</span> <span class="hljs-type">Just</span> <span class="hljs-string">&quot;Foo Bar Baz&quot;</span>
<span class="hljs-type">Nothing</span>
</code></pre></blockquote><h2>ihaskell-aeson</h2><p><a href="https://hackage.haskell.org/package/aeson" target="_blank" rel="noopener noreferrer">Aeson</a> is a library used to manipulate <em>JSON</em> format from Haskell. It allows you to use <code>ToJSON</code> and <code>FromJSON</code> typeclasses to convert your custom data-types <em>to</em> and <em>from</em> JSON format.</p><p>In our small example, we declare a type of document with an arbitrary number of metadata attached, here is how we could do it:</p><pre class="code" data-lang="haskell"><code>:extension <span class="hljs-type">OverloadedStrings</span>

<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Data.Text <span class="hljs-keyword">as</span> T
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Data.Aeson <span class="hljs-keyword">as</span> A
<span class="hljs-comment">-- IHaskell.Display.Aeson</span>

<span class="hljs-class"><span class="hljs-keyword">newtype</span> <span class="hljs-type">Property</span> = <span class="hljs-type">Property</span> <span class="hljs-type">T</span>.<span class="hljs-type">Text</span></span>
<span class="hljs-class"><span class="hljs-keyword">newtype</span> <span class="hljs-type">Value</span> = <span class="hljs-type">Value</span> <span class="hljs-type">T</span>.<span class="hljs-type">Text</span></span>
<span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">Metadata</span> = <span class="hljs-type">Metadata</span> [(<span class="hljs-type">Property</span>, <span class="hljs-type">Value</span>)]</span>

<span class="hljs-class"><span class="hljs-keyword">newtype</span> <span class="hljs-type">Body</span> = <span class="hljs-type">Body</span> <span class="hljs-type">T</span>.<span class="hljs-type">Text</span></span>
<span class="hljs-class"><span class="hljs-keyword">newtype</span> <span class="hljs-type">Title</span> = <span class="hljs-type">Title</span> <span class="hljs-type">T</span>.<span class="hljs-type">Text</span></span>
<span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">Document</span>  = <span class="hljs-type">Document</span></span>
    { _title :: <span class="hljs-type">Title</span>
    , _body :: <span class="hljs-type">Body</span>
    , _metadata :: <span class="hljs-type">Metadata</span>}
<span class="hljs-class">
<span class="hljs-keyword">instance</span> <span class="hljs-type">A</span>.<span class="hljs-type">ToJSON</span> <span class="hljs-type">Metadata</span> <span class="hljs-keyword">where</span></span>
   toJSON (<span class="hljs-type">Metadata</span> d) = <span class="hljs-type">A</span>.object $ [p <span class="hljs-type">A</span>..= v | (<span class="hljs-type">Property</span> p, <span class="hljs-type">Value</span> v) &lt;- d]
<span class="hljs-class">
<span class="hljs-keyword">instance</span> <span class="hljs-type">A</span>.<span class="hljs-type">ToJSON</span> <span class="hljs-type">Document</span> <span class="hljs-keyword">where</span></span>
   toJSON (<span class="hljs-type">Document</span> (<span class="hljs-type">Title</span> t) (<span class="hljs-type">Body</span> b) m) = <span class="hljs-type">A</span>.object [
       <span class="hljs-string">&quot;title&quot;</span> <span class="hljs-type">A</span>..= t,
       <span class="hljs-string">&quot;body&quot;</span> <span class="hljs-type">A</span>..= b,
       <span class="hljs-string">&quot;metadata&quot;</span> <span class="hljs-type">A</span>..= <span class="hljs-type">A</span>.toJSON m]

<span class="hljs-title">document</span> = <span class="hljs-keyword">let</span> body = <span class="hljs-type">Body</span> <span class="hljs-string">&quot;Lorem Ipsum&quot;</span>
               title = <span class="hljs-type">Title</span> <span class="hljs-string">&quot;Foo Bar&quot;</span>
               metadata = <span class="hljs-type">Metadata</span> [
                   (<span class="hljs-type">Property</span> <span class="hljs-string">&quot;Encoding&quot;</span>, <span class="hljs-type">Value</span> <span class="hljs-string">&quot;UTF-8&quot;</span>),
                   (<span class="hljs-type">Property</span> <span class="hljs-string">&quot;Author&quot;</span>, <span class="hljs-type">Value</span> <span class="hljs-string">&quot;Jonh Doe&quot;</span>)]
           <span class="hljs-keyword">in</span> <span class="hljs-type">Document</span> {_title=title, _body=body, _metadata=metadata }

<span class="hljs-type">A</span>.<span class="hljs-type">Null</span>
<span class="hljs-type">A</span>.<span class="hljs-type">Bool</span> <span class="hljs-type">True</span>
<span class="hljs-type">A</span>.toJSON document
</code></pre><blockquote><pre class="code" data-lang="haskell"><code><span class="hljs-title">null</span>

<span class="hljs-title">true</span>

{
    <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-string">&quot;Lorem Ipsum&quot;</span>,
    <span class="hljs-string">&quot;metadata&quot;</span>: {
        <span class="hljs-string">&quot;Author&quot;</span>: <span class="hljs-string">&quot;Jonh Doe&quot;</span>,
        <span class="hljs-string">&quot;Encoding&quot;</span>: <span class="hljs-string">&quot;UTF-8&quot;</span>
    },
    <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Foo Bar&quot;</span>
}
</code></pre></blockquote><h2>ihaskell-blaze</h2><p><a href="https://hackage.haskell.org/package/blaze-html" target="_blank" rel="noopener noreferrer">Blaze</a> is a fast combinator library used to assemble <em>HTML</em> documents directly in Haskell code <em>(<a href="https://wiki.haskell.org/Embedded_domain_specific_language" target="_blank" rel="noopener noreferrer">Embedded Domain Specific Language</a>)</em>. According to the official description, <em>“the project is aimed at those who seek to write web applications in Haskell – it integrates well with all Haskell web frameworks.”</em></p><pre class="code" data-lang="haskell"><code><span class="hljs-comment">-- This example if from the IHaskell official introduction</span>
:extension <span class="hljs-type">OverloadedStrings</span>

<span class="hljs-comment">-- import IHaskell.Display.Blaze</span>
<span class="hljs-keyword">import</span> Control.Monad
<span class="hljs-keyword">import</span> Prelude <span class="hljs-keyword">hiding</span> (<span class="hljs-title">div</span>, <span class="hljs-title">id</span>)
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Text.Blaze.Html4.Strict <span class="hljs-keyword">as</span> B
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Text.Blaze.Html4.Strict.Attributes <span class="hljs-keyword">as</span> A

<span class="hljs-title">forM</span> [<span class="hljs-number">1</span>..<span class="hljs-number">5</span>] $ \size -&gt; <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">let</span> s = <span class="hljs-type">B</span>.toValue $ size * <span class="hljs-number">70</span>
  <span class="hljs-type">B</span>.img <span class="hljs-type">B</span>.! <span class="hljs-type">A</span>.src <span class="hljs-string">&quot;https://www.google.com/images/srpr/logo11w.png&quot;</span> <span class="hljs-type">B</span>.! <span class="hljs-type">A</span>.width s
</code></pre><img src="../images/google-logo.png" width="70"> <img src="../images/google-logo.png" width="140"> <img src="../images/google-logo.png" width="210"> <img src="../images/google-logo.png" width="280"> <img src="../images/google-logo.png" width="350"><h2>ihaskell-charts</h2><p><a href="https://hackage.haskell.org/package/Chart" target="_blank" rel="noopener noreferrer">Charts</a> is a <em>“2D charting library for haskell”</em>. Here a two examples taken from the <a href="https://github.com/timbod7/haskell-chart/wiki" target="_blank" rel="noopener noreferrer">official wiki</a> on github. To adapt examples to notebooks, you must replace any reference of <code>toFile</code>, etc. by <code>toRenderable</code>.</p><pre class="code" data-lang="haskell"><code><span class="hljs-comment">-- This example is taken from the wiki: https://github.com/timbod7/haskell-chart/wiki/example%205</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Graphics.Rendering.Chart.Easy <span class="hljs-keyword">as</span> E

<span class="hljs-title">values</span> :: [(<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>, <span class="hljs-type">Bool</span>)]
<span class="hljs-title">values</span> = [ (<span class="hljs-string">&quot;Mexico City&quot;</span>, <span class="hljs-number">19.2</span>, <span class="hljs-type">False</span>)
         , (<span class="hljs-string">&quot;Mumbai&quot;</span>, <span class="hljs-number">12.9</span>, <span class="hljs-type">False</span>)
         , (<span class="hljs-string">&quot;Sydney&quot;</span>, <span class="hljs-number">4.3</span>, <span class="hljs-type">False</span>)
         , (<span class="hljs-string">&quot;London&quot;</span>, <span class="hljs-number">8.3</span>, <span class="hljs-type">False</span>)
         , (<span class="hljs-string">&quot;New York&quot;</span>,<span class="hljs-number">8.2</span>,<span class="hljs-type">True</span>)]

<span class="hljs-title">pitem</span> (s, v, o) = <span class="hljs-type">E</span>.pitem_value <span class="hljs-type">E</span>..~ v
              $ <span class="hljs-type">E</span>.pitem_label <span class="hljs-type">E</span>..~ s
              $ <span class="hljs-type">E</span>.pitem_offset <span class="hljs-type">E</span>..~ (<span class="hljs-keyword">if</span> o <span class="hljs-keyword">then</span> <span class="hljs-number">25</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)
              $ <span class="hljs-type">E</span>.def

<span class="hljs-type">E</span>.toRenderable
  $ <span class="hljs-type">E</span>.pie_title <span class="hljs-type">E</span>..~ <span class="hljs-string">&quot;Relative Population&quot;</span>
  $ <span class="hljs-type">E</span>.pie_plot . <span class="hljs-type">E</span>.pie_data <span class="hljs-type">E</span>..~ map pitem values
  $ <span class="hljs-type">E</span>.def
</code></pre><figure><a href="../images/ihaskell-chart.svg" target="_blank" rel="noopener noreferrer"><img src="../images/ihaskell-chart.svg" alt=""></a><figcaption>pie chart</figcaption></figure><pre class="code" data-lang="haskell"><code><span class="hljs-comment">-- This example is taken from the wiki: https://github.com/timbod7/haskell-chart/wiki/example%2012</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Graphics.Rendering.Chart.Easy <span class="hljs-keyword">as</span> E

<span class="hljs-title">r&#x27;</span> x y z = sqrt $ x^<span class="hljs-number">2</span> + y^<span class="hljs-number">2</span> + z^<span class="hljs-number">2</span>
<span class="hljs-title">efield</span> sign x y = (sign * x / r, sign * y / r) <span class="hljs-keyword">where</span> r = r&#x27; x y <span class="hljs-number">10</span>
<span class="hljs-title">bfield</span> sign x y = (-sign * y / r^<span class="hljs-number">2</span>, sign * x / r^<span class="hljs-number">2</span>) <span class="hljs-keyword">where</span> r = r&#x27; x y <span class="hljs-number">10</span>
<span class="hljs-title">square</span> a s = [(x, y) | x &lt;- range, y &lt;- range] <span class="hljs-keyword">where</span> range = [-a, -a + s..a] :: [<span class="hljs-type">Double</span>]
<span class="hljs-title">add</span> (x1, y1) (x2, y2) = (x1 + x2, y1 + y2)

<span class="hljs-title">ef</span> (x, y) = efield <span class="hljs-number">1</span> (x - <span class="hljs-number">20</span>) y `add` efield (-<span class="hljs-number">1</span>) (x + <span class="hljs-number">20</span>) y
<span class="hljs-title">bf</span> (x, y) = bfield <span class="hljs-number">1</span> (x - <span class="hljs-number">20</span>) y `add` bfield (-<span class="hljs-number">1</span>) (x + <span class="hljs-number">20</span>) y
<span class="hljs-title">grid</span> = square <span class="hljs-number">30</span> <span class="hljs-number">3</span>

<span class="hljs-title">vectorField</span> title f grid = fmap <span class="hljs-type">E</span>.plotVectorField $ <span class="hljs-type">E</span>.liftEC $ <span class="hljs-keyword">do</span>
    c &lt;- <span class="hljs-type">E</span>.takeColor
    <span class="hljs-type">E</span>.plot_vectors_mapf <span class="hljs-type">E</span>..= f
    <span class="hljs-type">E</span>.plot_vectors_grid <span class="hljs-type">E</span>..= grid
    <span class="hljs-type">E</span>.plot_vectors_style . <span class="hljs-type">E</span>.vector_line_style . <span class="hljs-type">E</span>.line_color <span class="hljs-type">E</span>..= c
    <span class="hljs-type">E</span>.plot_vectors_style . <span class="hljs-type">E</span>.vector_head_style . <span class="hljs-type">E</span>.point_color <span class="hljs-type">E</span>..= c
    <span class="hljs-type">E</span>.plot_vectors_title <span class="hljs-type">E</span>..= title

<span class="hljs-title">main</span> = <span class="hljs-type">E</span>.toRenderable $ <span class="hljs-keyword">do</span>
    <span class="hljs-type">E</span>.setColors [<span class="hljs-type">E</span>.opaque <span class="hljs-type">E</span>.black, <span class="hljs-type">E</span>.opaque <span class="hljs-type">E</span>.blue]

    <span class="hljs-type">E</span>.layout_title <span class="hljs-type">E</span>..= <span class="hljs-string">&quot;Positive and Negative Charges&quot;</span>
    <span class="hljs-type">E</span>.plot $ vectorField <span class="hljs-string">&quot;Electric Field&quot;</span> ef grid
    <span class="hljs-type">E</span>.plot $ vectorField <span class="hljs-string">&quot;B-field&quot;</span> bf grid
<span class="hljs-title">main</span>
</code></pre><figure><a href="../images/ihaskell-field.svg" target="_blank" rel="noopener noreferrer"><img src="../images/ihaskell-field.svg" alt=""></a><figcaption>field</figcaption></figure><h2>ihaskell-diagrams</h2><p><a href="http://projects.haskell.org/diagrams/" target="_blank" rel="noopener noreferrer">Diagrams</a> is a <em>“powerful, flexible, declarative domain-specific language for creating vector graphics”</em>. That is, it provides a flexible embedded DSL used to describe vectorized figures that you can then render using different backends.</p><pre class="code" data-lang="haskell"><code>:extension <span class="hljs-type">NoMonomorphismRestriction</span>
:extension <span class="hljs-type">FlexibleContexts</span>
:extension <span class="hljs-type">GADTs</span>

<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Diagrams.Prelude <span class="hljs-keyword">as</span> D
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Diagrams.TwoD.Sunburst <span class="hljs-keyword">as</span> S
<span class="hljs-keyword">import</span> Data.Tree (<span class="hljs-title">unfoldTree</span>)

<span class="hljs-title">aTree</span> = unfoldTree (\n -&gt; (<span class="hljs-number">0</span>, replicate n (n - <span class="hljs-number">1</span>))) <span class="hljs-number">6</span>
<span class="hljs-title">diagram</span> $ <span class="hljs-type">S</span>.sunburst aTree <span class="hljs-type">D</span>.# <span class="hljs-type">D</span>.centerXY <span class="hljs-type">D</span>.# <span class="hljs-type">D</span>.pad <span class="hljs-number">1.1</span>
</code></pre><figure><a href="../images/ihaskell-diagram1.svg" target="_blank" rel="noopener noreferrer"><img src="../images/ihaskell-diagram1.svg" alt=""></a><figcaption>field</figcaption></figure><pre class="code" data-lang="haskell"><code><span class="hljs-comment">-- import Diagrams.Backend.SVG.CmdLine as</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Diagrams.Prelude <span class="hljs-keyword">as</span> D
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Diagrams.TwoD.Factorization <span class="hljs-keyword">as</span> F

<span class="hljs-title">diagram</span> $ <span class="hljs-type">F</span>.fdGridList <span class="hljs-number">6</span> <span class="hljs-type">D</span>.# <span class="hljs-type">D</span>.center <span class="hljs-type">D</span>.# <span class="hljs-type">D</span>.pad <span class="hljs-number">1.05</span>
</code></pre><figure><a href="../images/ihaskell-diagram2.svg" target="_blank" rel="noopener noreferrer"><img src="../images/ihaskell-diagram2.svg" alt=""></a><figcaption>field</figcaption></figure><h2>ihaskell-magic</h2><p>In this case, libmagic is used to determine type of files using magic values at the beginning, which allows us to display binary content in notebooks, in the right way. For example, if we want to display an image (png, jpeg, svg, etc.), we just have to read its content as a <code>ByteString</code>, then <code>libmagic</code> is used behind the scene by <em>IHaskell</em> to determine what kind of content it is, based on the magic bytes present in the file, and then inline it in the notebook.</p><p>What is important to understand here, is that an instance of IHaskellDisplay is defined for both <code>ByteString</code> and <code>Text</code>, in case this strings represent something else than text (images, for example), <em>IHaskell</em> is able to know it thanks to <code>libmagic</code> and display the content accordingly, otherwise, it just displays the string.</p><pre class="code" data-lang="haskell"><code><span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Data.ByteString <span class="hljs-keyword">as</span> B
<span class="hljs-type">B</span>.readFile <span class="hljs-string">&quot;./haskell-logo.png&quot;</span>
</code></pre><figure><a href="../images/output_25_0.png" target="_blank" rel="noopener noreferrer"><img src="../images/output_25_0.png" alt=""></a><figcaption>Haskell logo</figcaption></figure><pre class="code" data-lang="haskell"><code>:extension <span class="hljs-type">OverloadedStrings</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Data.ByteString <span class="hljs-keyword">as</span> B
<span class="hljs-string">&quot;This is a string of type ByteString&quot;</span> :: <span class="hljs-type">B</span>.<span class="hljs-type">ByteString</span>
</code></pre><pre class="code" data-lang="sh"><code>This is a string of <span class="hljs-built_in">type</span> ByteString
</code></pre><pre class="code" data-lang="haskell"><code>:extension <span class="hljs-type">OverloadedStrings</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">qualified</span> Data.Text <span class="hljs-keyword">as</span> T
<span class="hljs-string">&quot;This is a string of type Text&quot;</span> :: <span class="hljs-type">T</span>.<span class="hljs-type">Text</span>
</code></pre><pre class="code" data-lang="sh"><code>This is a string of <span class="hljs-built_in">type</span> Text
</code></pre><h2>ihaskell-static-canvas</h2><p>Following on the <a href="https://github.com/gibiansky/IHaskell/blob/master/notebooks/Static%20Canvas%20IHaskell%20Display.ipynb" target="_blank" rel="noopener noreferrer">excellent introduction</a> from the author of <em>IHaskell</em>. Let’s try to use <a href="https://github.com/jeffreyrosenbluth/static-canvas" target="_blank" rel="noopener noreferrer">static-canvas</a> to create more elaborate inlings in notebooks! The github page is full of <a href="" target="_blank" rel="noopener noreferrer">examples</a> that we can try out right now. But before that, we must create an instance of <code>IHaskellDisplay</code> for <code>CanvasFree</code> (which is taken directly from the mentionned tutorial (I hope it’s Ok, since <code>ihaskell-static-canvas</code> doesn’t seem to be part of Stackage LTS at the moment).</p><pre class="code" data-lang="haskell"><code><span class="hljs-keyword">import</span> IHaskell.Display <span class="hljs-comment">-- From the &#x27;ihaskell&#x27; package.</span>
<span class="hljs-keyword">import</span> IHaskell.IPython.Types (<span class="hljs-type">MimeType(..)</span>)
<span class="hljs-keyword">import</span> Graphics.Static  <span class="hljs-comment">-- From the &#x27;static-canvas&#x27; package.</span>

<span class="hljs-comment">-- Text conversion functions.</span>
<span class="hljs-keyword">import</span> Data.Text.Lazy.Builder (<span class="hljs-title">toLazyText</span>)
<span class="hljs-keyword">import</span> Data.Text.Lazy (<span class="hljs-title">toStrict</span>)
</code></pre><pre class="code" data-lang="haskell"><code><span class="hljs-comment">-- Since CanvasFree is a type synonym, we need a language pragma.</span>
:extension <span class="hljs-type">TypeSynonymInstances</span>
:extension <span class="hljs-type">FlexibleInstances</span>
<span class="hljs-class">
<span class="hljs-keyword">instance</span> <span class="hljs-type">IHaskellDisplay</span> (<span class="hljs-type">CanvasFree</span> ()) <span class="hljs-keyword">where</span></span>
  <span class="hljs-comment">-- display :: CanvasFree () -&gt; IO Display</span>
  display canvas = return $
    <span class="hljs-keyword">let</span> src = toStrict
      $ toLazyText
      $ buildScript width height canvas
    <span class="hljs-keyword">in</span> <span class="hljs-type">Display</span> [<span class="hljs-type">DisplayData</span> <span class="hljs-type">MimeHtml</span> src]
    <span class="hljs-keyword">where</span> (height, width) = (<span class="hljs-number">200</span>, <span class="hljs-number">600</span>)
</code></pre><p>Now let’s try some example:</p><pre class="code" data-lang="haskell"><code><span class="hljs-keyword">import</span> Graphics.Static
<span class="hljs-keyword">import</span> Graphics.Static.ColorNames

<span class="hljs-title">text</span> :: <span class="hljs-type">CanvasFree</span> ()
<span class="hljs-title">text</span> = <span class="hljs-keyword">do</span>
  font <span class="hljs-string">&quot;italic 60pt Calibri&quot;</span>
  lineWidth <span class="hljs-number">6</span>
  strokeStyle blue
  fillStyle goldenrod
  textBaseline <span class="hljs-type">TextBaselineMiddle</span>
  strokeText <span class="hljs-string">&quot;Haskell&quot;</span> <span class="hljs-number">150</span> <span class="hljs-number">100</span>
  fillText <span class="hljs-string">&quot;Haskell!&quot;</span> <span class="hljs-number">150</span> <span class="hljs-number">100</span>

<span class="hljs-title">text</span>
</code></pre><figure><a href="../images/ihaskell-canvas.png" target="_blank" rel="noopener noreferrer"><img src="../images/ihaskell-canvas.png" alt=""></a></figure><h2>Conclusion</h2><p>This was a short introduction without much new stuff, but it gave me a better understanding on how <em>IHaskell</em> (and in a way, <em>Jupyter</em>) works. Thanks to the awesome work of some haskellers, we are able to benefit from the great <em>Jupyter</em> ecosystem, and I think it can bring a lot to <em>Haskell</em> itself. It’s easier to share code, easier to write about <em>Haskell</em>-related stuff, easier to dig into a new projet.</p><p><em>IHaskell</em> is a solid foundation for more to come: more widgets, more integrations with <em>Haskell</em> libraries, etc. I wonder if, for example, we could use <em>Blaze</em> to generate <em>Display</em> on-the-fly? Could we reuse some code from the <em>Python</em> Kernel of <em>Jupyter</em>? I’m also looking forward to try the <code>ihaskell-widgets</code> extension.</p><p>That’s pretty much it, I’d like to say I’m very excited for Haskell, because it becomes much more accessible for newcomers, thanks to (for example) Stack, IHaskell, and lot of effort that is being made by the community. I hope I can continue to contribute at my level to this effort!</p><p>Thanks for reading!</p></div><div class="comments"></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io/posts/ihashell-extensions-tour.html&t=A tour of IHaskell extensions" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-facebook"></div></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io/posts/ihashell-extensions-tour.html&text=A tour of IHaskell extensions&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-twitter"></div></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io/posts/ihashell-extensions-tour.html&title=A tour of IHaskell extensions" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-pocket"></div></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io/posts/ihashell-extensions-tour.html&t=A tour of IHaskell extensions" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-hackernews"></div></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io/posts/ihashell-extensions-tour.html&title=A tour of IHaskell extensions" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><div class="sharing sharing-reddit"></div></a></li></ul></div></footer></main></body></html>