<!DOCTYPE html><html lang="fr" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Pypy—Make Python faster!</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/pypy-makes-python-faster.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1{line-height:1.1em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}h1,h2,h3{padding-top:.7em}.header{color:#555;margin-top:-.8em}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;font-style:italic;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{display:block;overflow-x:auto}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.share img{width:2em}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>Pypy—Make Python faster!</h1><section class="header"><div>└─ 2011-11-10 • <em>Reading time: ~8 minutes</em></div></section><article><div class="main"><p>J’inaugure ce blog avec un article sur Pypy, une implémentation de Python très intéressante du point de vue des performances puisque, comme nous le verrons un peu plus bas, il est possible de rivaliser avec des langages compilés statiquement tels que le C ou le C++. L’article se décomposera de la façon suivante :</p><ol><li>Qu’est-ce que Python.</li><li>Quelles sont les différentes implémentation ?</li><li>Qu’est-ce qui caractérise Pypy ?</li><li>La compilation JIT (Just-In-Time).</li><li>Compiler et utiliser Pypy.</li><li>Bref aperçu des performances.</li></ol><h2 id="quest-ce-que-python">Qu’est ce que Python</h2><p>Python est un langage de programmation moderne classé dans la catégorie des langages de scripts (il est interprété, du moins dans son implémentation officielle, CPython). Étant très haut niveau, il permet aux développeurs de gagner en productivité en leur permettant de se détacher au maximum des contraintes bas niveaux que l’on peut retrouver sur d’autres langages tels que le C, ce qui en fait un langage adapté pour l’apprentissage de la programmation. En effet, il est facile d’accès et rapide à apprendre. Sa syntaxe, basée sur l’indentation (pas d’accolades ni de mot-clef pour séparer les « blocs » d’instruction) le rend plus lisible que la plupart des langages. Pour terminer, voici quelques spécificités du langage : Inférence de type, fonctionnalités objet avancées, type entier de taille arbitraire, compréhension de listes permettant de créer des listes de manière élégante, etc ..</p><h2 id="quelles-sont-les-différentes-implémentations">Quelles sont les différentes implémentations</h2><p>Le langage Python étant placé sous licence libre, il en existe de nombreuses implémentations ayant chacune leurs spécificités. En voici quelques-unes :</p><ol><li><em>CPython</em> : Implémentation officielle (la plus connue) écrite en C.</li><li><em>Pypy</em> : Implémentation disposant d’un compilateur JIT (Just-In-Time).</li><li><em>ShedSkin</em> : Implémentation disposant d’un compilateur Python-to-C++ et offrant des performances très intéressantes du point de vu du temps d’exécution.</li><li><em>Stackless</em> : Implémentation qui se passe de la pile d’appels du C en la remplaçant par une structure de données propre au Python. Cette implémentation est grandement basée sur le paradigme de la concurrence, faisant appel à des Tasklets (sorte de micro-threads) afin de simuler une exécution parallèle des programmes. Les Tasklets peuvent être créées par centaines (voire milliers), communiquer entre elles facilement, être mise en pause ou réveillées instantanément, etc ..</li><li><em>Jython</em> : Implémentation écrite en Java.</li><li><em>Iron Python</em> : Implémentation écrite en C#.</li></ol><h2 id="quest-ce-qui-caractérise-pypy">Qu’est-ce qui caractérise Pypy</h2><p>Pypy est une implémentation de Python, écrite en Python, et proposant (entre autres), un compilateur JIT (cf paragraphe suivant) lui permettant de délivrer des performances dignes de la plupart des langages compilés statiquement (C, C++, etc..). Pypy offre également une consommation mémoire réduite par rapport à CPython, et supporte la plupart des bibliothèques disponibles avec l’implémentation officielle.</p><p>Il est également possible de compiler Pypy pour obtenir une version SandBox ou Stackless de Python. D’autres langages sont également supportés par Pypy (Javascript, Scheme, etc..) puisque ce dernier utilise une chaine de traitement qui peut analyser des programmes écrits en RPython (un subset réduit du langage Python), les traduire en code C puis les compiler en code machine, ce qui permet à n’importe quel langage d’être utilisé avec Pypy à condition qu’ils puissent être traduit en RPython. Pour plus d’informations, je vous invite à consulter le site officiel de Pypy dont le lien est communiqué en fin d’article.</p><h2 id="la-compilation-jit-just-in-time">La compilation JIT (Just-In-Time)</h2><p>Le langage Python offrant des outils très haut niveau (tels que des fonctionnalités Objet avancées), il est difficile et globalement inefficace (comparativement à des langages plus bas niveaux tels que le C) de le compiler statiquement, on ne se tournera donc pas vers de la compilation statique si l’on recherche des performances honorables. Il existe heureusement une alternative très performante à la compilation statique, il s’agit de la compilation JIT (Just-In-Time, ou « à la volée »). C’est cette technologie qui est utilisée dans le projet Pypy, ce qui permet d’offrir au langage Python des performances dignes de langages compilés statiquement tels que le C ou le C++. Voyons de quoi il s’agit.</p><p>La compilation Just-In-Time (ou dynamique) représente une approche hybride entre la compilation statique et l’interprétation, elle a pour but d’obtenir des performance égales, voire supérieures, à la compilation statique classique. Les compilateurs JIT convertissent du Bytecode en code machine à la volée (au moment de l’exécution). Mais pour limiter la dégradation des performances, plusieurs techniques sont utilisées. Premièrement, il est possible de mettre en cache certaines parties d’un programme afin de ne pas avoir à les retraduire inutilement lors d’exécutions ultérieures si leur code source n’a pas été modifié entre temps. Deuxièmement, grâce à un système de détection des points chauds (parties d’un programmes étant très sollicitées lors de l’exécution), le compilateur peut décider de traduire une partie du programme en code machine si cela s’avère plus intéressant qu’une simple interprétation en terme de temps d’exécution.</p><p>De plus, de nombreuses optimisations ne sont possibles qu’au moment de l’exécution du programme. Un compilateur JIT peut donc utiliser les informations du contexte d’exécution afin d’améliorer les performance d’un programme. Notamment, il est possible d’adapter le code machine produit en fonction de l’architecture du processeur ou encore d’effectuer de l’inlining de bibliothèques dynamiques, sans perdre pour autant les avantages du linkage dynamique.</p><p>La compilation JIT est utilisée par la machine virtuelle du Java ou encore le C#.</p><h2 id="compiler-et-utiliser-pypy">Compiler et utiliser Pypy</h2><p>Il existe deux solutions pour utiliser Pypy. Soit votre distribution Linux favorite vous le propose directement depuis ses dépôts, auquel cas il vous suffit de l’installer, soit vous pouvez télécharger les sources depuis le mercurial de Pypy. Attention néanmoins, si vous installez Pypy depuis les dépôts de votre distribution, il est possible qu’il remplace une version existante de Python sur votre ordinateur.</p><p><em>Building from sources</em> : Nous allons voir ici comment télécharger les sources de Pypy, les compiler puis utiliser le binaire produit. Avant toute chose, il faut savoir que la compilation de Pypy est extrêmement gourmande en ressources (mémoire vive et CPU), si vous n’avez pas 4 Go de RAM sur votre PC, il faudra passer par les dépôts de votre distribution, sans quoi vous risquez de partir en Swap infini ..</p><p><em>Liste des dépendances</em> : <a href="http://pypy.readthedocs.org/en/latest/getting-started-python.html#translating-the-pypy-python-interpreter">http://pypy.readthedocs.org/en/latest/getting-started-python.html#translating-the-pypy-python-interpreter</a></p><p>Une fois toutes les dépendances installées, récupérez les sources de Pypy en lançant la commande suivant :</p><pre><code class="language-sh">$ hg <span class="hljs-built_in">clone</span> https://bitbucket.org/pypy/pypy</code></pre><p>Rendez-vous ensuite dans le répertoire goal :</p><pre><code class="language-sh">$ <span class="hljs-built_in">cd</span> pypy/pypy/translator/goal</code></pre><p>Lancez enfin le script avec Python (ou avec Pypy lui-même si vous l’avez déjà installé, ce qui vous fera économiser du temps et de la mémoire) :</p><pre><code class="language-sh">$ python2 translate.py -Ojit</code></pre><p>Vous apprécierez au passage les fractales de Mandelbrot qui seront dessinées dans votre terminal pendant la compilation.</p><p>Une fois le long processus terminé, un binaire nommé pypy-c est normalement présent dans le répertoire. Vous pouvez le renommer et/ou le déplacer afin de l’utiliser comme bon vous semble. Il remplace le binaire Python traditionnel, vous pouvez donc l’utiliser de la façon suivante :</p><pre><code class="language-sh">$ ./pypy mon_script.py <span class="hljs-comment"># votre script python</span></code></pre><h2 id="bref-aperçu-des-performances">Bref aperçu des performances</h2><p>Pour terminer, voici un bref aperçu des performances de Pypy comparativement à d’autres implémentations/langages disponible sur la page Performance officielle du site de Pypy : <a href="http://speed.pypy.org/">http://speed.pypy.org/</a></p><h2 id="bibliographie">Bibliographie</h2><ul><li><a href="http://pypy.org/index.html">http://pypy.org/index.html</a></li><li><a href="http://fr.wikipedia.org/wiki/PyPy">http://fr.wikipedia.org/wiki/PyPy</a></li><li><a href="http://en.wikipedia.org/wiki/PyPy">http://en.wikipedia.org/wiki/PyPy</a></li><li><a href="http://en.wikipedia.org/wiki/Just-in-time_compilation">http://en.wikipedia.org/wiki/Just-in-time_compilation</a></li><li><a href="http://www.python.org/">http://www.python.org/</a></li><li><a href="http://fr.wikibooks.org/wiki/Python">http://fr.wikibooks.org/wiki/Python</a></li></ul><p>Le mot de la fin – Toutes les propositions et remarques sont bien évidemment les bienvenues :)</p></div><div class="comments"></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io//posts/pypy-makes-python-faster.html&t=Pypy—Make Python faster!" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Share on Facebook" src="/images/social_flat_rounded_rects_svg/Facebook.svg"><a></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io//posts/pypy-makes-python-faster.html&text=Pypy—Make Python faster!&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Tweet" src="/images/social_flat_rounded_rects_svg/Twitter.svg"><a></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io//posts/pypy-makes-python-faster.html&title=Pypy—Make Python faster!" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Add to Pocket" src="/images/social_flat_rounded_rects_svg/Pocket.svg"><a></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io//posts/pypy-makes-python-faster.html&t=Pypy—Make Python faster!" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Hacker News" src="/images/social_flat_rounded_rects_svg/HackerNews.svg"><a></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io//posts/pypy-makes-python-faster.html&title=Pypy—Make Python faster!" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Reddit" src="/images/social_flat_rounded_rects_svg/Reddit.svg"><a></a></li></ul></div></footer></main></body></html>