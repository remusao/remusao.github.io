<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Parsing Thunderbird Message Filters</title><meta name="description" content="Simplex Sigillum Veri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="canonical" href="https://remusao.github.io/posts/parsing-thunderbird-msg-filters.html"><link rel="icon" type="image/x-icon" href="/images/favicon.ico"><style type="text/css">body{color:#2f2f2f;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;line-height:1.6em;margin:20px auto;max-width:40rem;padding:0 1.5em;text-rendering:optimizeLegibility}h1,h2,h3{padding-top:.7em}h2{border-bottom:1px solid #eaecef;padding-bottom:.5em}.header,.main figcaption{color:#555;font-style:italic}.main a{color:#3465a4}.main a:visited{color:#75507b}.main figcaption{color:#696f72;line-height:2em;text-align:center}.main img{display:block;height:auto;margin:auto;padding-bottom:1em;padding-top:1em;width:90%}.main blockquote{border-left:thin solid #d3d7cf;color:#555;margin:10px;padding:0 0 0 1em}code{background-color:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:14px;line-height:20px;padding:.2em .4em}pre code{display:block;overflow-x:auto}.leave-comment-btn,summary{font-size:16px;font-weight:600}.leave-comment-btn{background-color:#28a745;background-image:linear-gradient(-180deg,#34d058,#28a745 90%);border:1px solid rgba(27,31,35,.2);border-radius:.25em;color:#fff;display:inline-block;margin-top:1.5em;padding:3px 10px;text-decoration:none}.leave-comment-btn:hover{box-shadow:0 1px 3px rgba(0,0,0,.24)}summary{color:#516ae8;cursor:pointer;line-height:1.2rem;margin-top:2rem}.comments-list{list-style:none;padding:0}.comment{background-color:#fff;border:1px solid #d1d5da;border-radius:3px;color:#24292e;font-size:16px;margin:1em 0}.meta{background-color:#f6f8fa;border-bottom:1px solid #d1d5da;color:#586069}.author,.date{text-decoration:none}.author{color:#24292e!important;font-weight:700}.date{color:#586069}.date:hover{color:#0366d6}.content{padding-left:20px}.avatar,.emoji{vertical-align:middle}.avatar{display:inline-block;margin-right:5px}.emoji{height:1.1em;width:1.1em}table{border-collapse:collapse;margin:auto}td,th{border:1px solid #ddd;padding:10px}tr:hover{background-color:#f5f5f5}footer{border-top:thin solid #d3d7cf;margin:1.5em 0}.share ul{text-align:right}.share li{display:inline;padding:0 5px}.share img{width:2em}.main a,header a{text-decoration:none}.hljs{background:#f8f8f8;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-quote{color:#6a737d;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#d73a49}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:#005cc5}.hljs-doctag,.hljs-string{color:#032f62}.hljs-section,.hljs-selector-id,.hljs-title{color:#900}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#6f42c1}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style></head><body><main><header><h1><a href="../"><span>../</span></a></h1></header><h1>Parsing Thunderbird Message Filters</h1><section class="header"><div>2019-11-24 | <em>Reading time: ~5 minutes</em></div></section><article><div class="main"><blockquote><p><a href="https://www.thunderbird.net/">Thunderbird</a> is a free email application that’s easy to set up and customize - and it’s loaded with great features!</p></blockquote><p>I have been using Thunderbird as my email client of choice for many years, it is the hub which allows me to manage all the emails I get: work, multiple personal addresses, etc. As of today my combined mail folders are about <code>30GB</code> and counting. Still, Thunderbird has been running rock solid and I had no issue so far.</p><p>I have to say that I make extensive use of folders, labels and <em>message filters</em>. These features combined allow to effortlessly manage a high volume of emails by filtering, sorting, tagging, dispatching emails; greatly reducing the amount of manual work needed to process then read them.</p><p>As an example, I receive a lot of emails notifications from GitHub, both for work and personal OSS projects. I also tend to follow activity of repositories which I find interesting; but I do not want to have to go through all these notifications myself. A few years ago I adopted the following strategy:</p><ol><li>Create folders or subfolders for each repository:<ul><li><code>github/work/repo1</code>,</li><li><code>github/work/repo2</code>,</li><li><code>github/perso/repo3</code>,</li><li>etc.</li></ul></li><li>Create a first filter rule <em>for each repository</em> to automatically move GitHub notifications to their respective folders. This can be achieve by detecting <code>notifications@github.com</code> using a condition of the form `From is <a href="mailto:&#x6e;&#x6f;&#116;&#105;&#102;&#105;&#x63;&#97;&#116;&#x69;&#x6f;&#x6e;&#115;&#x40;&#x67;&#105;&#x74;&#104;&#117;&#98;&#46;&#99;&#111;&#109;">&#x6e;&#x6f;&#116;&#105;&#102;&#105;&#x63;&#97;&#116;&#x69;&#x6f;&#x6e;&#115;&#x40;&#x67;&#105;&#x74;&#104;&#117;&#98;&#46;&#99;&#111;&#109;</a><code>and adding a</code>Move Message to` action.</li><li>Optionally, I create rules to automatically mark as read any message which is not directed to me specifically (e.g.: via direct mention of my GitHub handler, PR request, issue assigned, etc.); especially on very active repositories. This can be achieved by detecting things like <code>mention@noreply.github.com</code> or <code>assign@noreply.github.com</code> in the <code>Cc</code> field.</li></ol><p>GitHub has a <a href="https://help.github.com/en/github/receiving-notifications-about-activity-on-github/about-email-notifications">full page of documentation</a> describing all the values you can use to filter email notifications. This is <em>really useful<em>. For example I tag emails where I am directly mentioned in <strong>red</strong> but notifications about discussions that I was involved in but not directly mentioned with **blue</em></em>. This allows to filter at a glance what I really need to check, versus what I can check later. In practice, more than 90% of notifications do not need to be checked manually. This is huge!</p><p>Unfortunately, as the number of filters grows, I found the built-in interface to not be very convenient. Finding or editing rules can become a pain. Fortunately, Thunderbird stores all the filters for a given account in a single, plain text file named: <code>msgFilterRules.dat</code>, located in your Thunderbird profile folder. So I decided to write <a href="https://github.com/remusao/thunderbird-msg-filters">a library</a> which allows to manipulate these rules through a minimal and type-safe API; in <em>TypeScript</em>.</p><p>The goal of the project is to allow developing more high-level tooling to read, transform, extend, update the rules while not having to worry about the low-level parsing details. It would also be possible to store the rules in a nicer format then use the library to produce the final file which can be consumed by Thunderbird.</p><p>To install the library: <code>npm install --save thunderbird-msg-filters</code>.</p><p>You can then use it to parse a <code>msgFilterRules.dat</code> file which you can find in your Thunderbird folder (one per email account configured):</p><pre><code class="language-typescript"><span class="hljs-keyword">import</span> { parse } <span class="hljs-keyword">from</span> <span class="hljs-string">'thunderbird-msg-filters'</span>;

<span class="hljs-comment">// A typical `msgFilterRules.dat` could contain this raw value.</span>
<span class="hljs-keyword">const</span> rules = parse(<span class="hljs-string">`
version="9"
logging="no"
name="rule 1"
enabled="yes"
type="17"
action="Mark flagged"
condition="OR (subject,contains,foo) OR (subject,contains,bar)"
name="rule 2"
enabled="yes"
type="17"
action="Mark read"
action="JunkScore"
actionValue="100"
condition="ALL"
`</span>);</code></pre><p>You can also format rules to the same original format:</p><pre><code class="language-typescript"><span class="hljs-keyword">import</span> { format } <span class="hljs-keyword">from</span> <span class="hljs-string">'thunderbird-msg-filters'</span>;

<span class="hljs-keyword">const</span> rules = format({
  version: <span class="hljs-string">'9'</span>,
  logging: <span class="hljs-string">'no'</span>,
  rules: [
    {
      name: <span class="hljs-string">'rule 1'</span>,
      enabled: <span class="hljs-string">'yes'</span>,
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'17'</span>,
      actions: [{ name: <span class="hljs-string">'Mark flagged'</span>}],
      condition: <span class="hljs-string">'OR (subject,contains,foo) OR (subject,contains,bar)'</span>
    },
    {
      name: <span class="hljs-string">'rule 2'</span>,
      enabled: <span class="hljs-string">'yes'</span>,
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'17'</span>,
      actions: [
        { name: <span class="hljs-string">'Mark read'</span> }
        { name: <span class="hljs-string">'JunkScore'</span>, value: <span class="hljs-string">'100'</span> }
      ],
      condition: <span class="hljs-string">'ALL'</span>
    },
  ]
});</code></pre><p>The library is currently very young and will probably contain bugs, so use at your own risks. Feel free to use it and <a href="https://github.com/remusao/thunderbird-msg-filters/issues/new">open an issue</a> for any feedback!</p><p><strong>What’s next?</strong> I plan to use this library to store the message filters rules in a separate location and synchronize it potentially between multiple computers. The nice thing is that the rules can now be expressed in a typed language (TypeScript) which will give me more confidence about their validity. It is also much easier to manipulate them from a single file, in a familiar developer environment (i.e.: your editor of choice) than through the Thunderbird interface.</p><p>GitHub repository: <a href="https://github.com/remusao/thunderbird-msg-filters/">https://github.com/remusao/thunderbird-msg-filters/</a></p></div><div class="comments"><span><a class="leave-comment-btn" href="https://github.com/remusao/remusao.github.io/issues/73" title="https://github.com/remusao/remusao.github.io/issues/73" target="_blank" rel="noopener noreferrer">Leave a comment on GitHub</a></span></div></article><footer><div class="share"><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https://remusao.github.io//posts/parsing-thunderbird-msg-filters.html&t=Parsing Thunderbird Message Filters" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Share on Facebook" src="/images/social_flat_rounded_rects_svg/Facebook.svg"><a></a></li><li><a href="https://twitter.com/share?url=https://remusao.github.io//posts/parsing-thunderbird-msg-filters.html&text=Parsing Thunderbird Message Filters&via=Pythux" title="Tweet" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Tweet" src="/images/social_flat_rounded_rects_svg/Twitter.svg"><a></a></li><li><a href="https://getpocket.com/save?url=https://remusao.github.io//posts/parsing-thunderbird-msg-filters.html&title=Parsing Thunderbird Message Filters" title="Add to Pocket" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Add to Pocket" src="/images/social_flat_rounded_rects_svg/Pocket.svg"><a></a></li><li><a href="https://news.ycombinator.com/submitlink?u=https://remusao.github.io//posts/parsing-thunderbird-msg-filters.html&t=Parsing Thunderbird Message Filters" title="Submit to Hacker News" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Hacker News" src="/images/social_flat_rounded_rects_svg/HackerNews.svg"><a></a></li><li><a href="https://www.reddit.com/submit?url=https://remusao.github.io//posts/parsing-thunderbird-msg-filters.html&title=Parsing Thunderbird Message Filters" title="Submit to Reddit" target="_blank" rel="noopener noreferrer"><img loading="lazy" alt="Submit to Reddit" src="/images/social_flat_rounded_rects_svg/Reddit.svg"><a></a></li></ul></div></footer></main></body></html>